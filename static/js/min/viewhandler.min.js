var sb=sb||{};sb.viewhandler=function(){var c=d3.dispatch("updated","next","prev");var b=["edit","product","make","add-ons","checkout","review"];var g=$("#content");$("#product").waypoint(function(h){if(h=="down"){d()}else{f()}},{offset:500});$("#materials").waypoint(function(h){if(h=="down"){if(sb.materializer.product()){sb.rotator.update(sb.materializer.product())}}},{offset:550});$("#review").waypoint(function(i){if(i=="down"){a();if(sb.materializer.product()&&sb.materializer.material()){var h=sb.ui.orderer(meshu);h.updated()}}},{offset:700});function a(){if(sb.materializer.product()){$(".review-product").removeClass("inactive").text(sb.materializer.product())}if(sb.materializer.color()&&sb.materializer.material()){$(".review-material").removeClass("inactive").text(sb.materializer.color()+" "+sb.materializer.material())}if(sb.materializer.product()&&sb.materializer.color()&&sb.materializer.material()){$(".review-price").text(cashier.getPriceString());$("#add-to-cart").removeClass("inactive")}}c.updateViews=function(h){switch(h){case"edit":b=["edit","product","make","add-ons","checkout","review"];break;case"view":b=["view"];break;case"product":b=["product","make","add-ons","checkout","review"];break;default:b=["readymade","add-ons","checkout","review"];break}};c.updateAccountView=function(){if(user.loggedIn){e()}};c.initialize=function(){$(".next").live("click",d);$(".back").click(f)};function d(){var k=$(this);var h=c.view();var i=b.indexOf(h);var j=function(){g.attr("class",b[i+1])};if(h=="edit"&&user.loggedIn){saver.createOrUpdateMeshu()}if(h=="make"||h=="readymade"){e();user.afterLogIn=function(){saver.createOrUpdateMeshu(function(){k.click()})}}if(h=="account"&&!user.loggedIn){user.afterLogIn=function(){saver.createOrUpdateMeshu(function(){k.click()})};return}c.next();user.updateLogoutActions(h);j()}function f(){var h=c.view();if(h=="checkout"){e()}if(!user.loggedIn){user.afterLogIn=function(){saver.createOrUpdateMeshu(function(){$($(".next")[0]).click()})}}var i=b.indexOf(h);var j=b[i-1];g.attr("class",j);c.prev()}function e(){var h=b.indexOf("account");if(user.loggedIn){if(h>=0){b.splice(h,1)}$("#account").css("visibility","hidden")}else{if(h==-1){b.splice(-2,0,"account")}$("#account").css("visibility","visible");$("#account li").click(function(){var j=$(this).attr("id").split("-")[1];var i=$("#account");i.attr("class",j);i.find("li").removeClass("active");$(this).addClass("active")})}}c.view=function(h){if(!arguments.length){return g.attr("class")}var i=b.indexOf(h);if(i!=-1){g.attr("class",b[i]);view=h}};return c}();