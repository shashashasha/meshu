var sb=sb||{};sb.viewhandler=function(){var b=d3.dispatch("updated","next","prev");var a=["edit","product","make","account","checkout","review"];var f=$("#content");b.updateViews=function(g){switch(g){case"edit":a=["edit","product","make","account","checkout","review"];break;case"view":a=["view"];break;case"product":a=["product","make","account","checkout","review"];break;default:a=["readymade","account","checkout","review"];break}};b.updateAccountView=function(){if(user.loggedIn){d()}};b.initialize=function(){$(".next").live("click",c);$(".back").click(e)};function c(){if(!$(this).hasClass("active")){return}var j=$(this);var g=b.view();var h=a.indexOf(g);var i=function(){f.attr("class",a[h+1])};if(g=="edit"&&user.loggedIn){saver.createOrUpdateMeshu()}if(g=="make"||g=="readymade"){d();user.afterLogIn=function(){saver.createOrUpdateMeshu(function(){j.click()})}}if(g=="account"&&!user.loggedIn){user.afterLogIn=function(){saver.createOrUpdateMeshu(function(){j.click()})};return}b.next();user.updateLogoutActions(g);i()}function e(){var g=b.view();if(g=="checkout"){d()}if(!user.loggedIn){user.afterLogIn=function(){saver.createOrUpdateMeshu(function(){$($(".next")[0]).click()})}}var h=a.indexOf(g);var i=a[h-1];f.attr("class",i);b.prev()}function d(){var g=a.indexOf("account");if(user.loggedIn){if(g>=0){a.splice(g,1)}$("#account").css("visibility","hidden")}else{if(g==-1){a.splice(-2,0,"account")}$("#account").css("visibility","visible");$("#account li").click(function(){var i=$(this).attr("id").split("-")[1];var h=$("#account");h.attr("class",i);h.find("li").removeClass("active");$(this).addClass("active")})}}b.view=function(g){if(!arguments.length){return f.attr("class")}var h=a.indexOf(g);if(h!=-1){f.attr("class",a[h]);view=g}};return b}();