var sb=sb||{};$(function(){sb.product=function(){var a={};var b=[];a.initialize=function(d,c){b=c.getProducts();for(var e=0;e<b.length;e++){var f=b[e];a.resetPreviewImage(f.type);if(typeof d=="string"){a.previewFromSelector(f.type,d)}else{a.previewFromElement(f.type,d)}}};a.resetPreviewImage=function(d){var c=d3.select("#preview-"+d);c.select(".product-delaunay").remove()};a.previewFromSelector=function(m,g){var i=d3.select("#preview-"+m),n=meshu.mesh().getLongestRotation(),l=meshu.mesh().projectPoints(n),h=l.width/l.height,e=sb.transforms.getTransform(m,"product",l),j=e+meshu.mesh().getLongestRotation(90);if(m=="cufflinks"){meshu.mesh().transformedDelaunay(l,450,400,0);var f=$(g).clone().attr("class","product-delaunay").attr("transform",e);$(i[0]).append(f);meshu.mesh().refresh()}else{if(m=="necklace"){var c=450,d=450/h;var k="rotate(-"+[meshu.mesh().getRotationAngle(),300,300].join(",")+")";if(h>1.5){d=d*2}meshu.mesh().transformedDelaunay(l,c,d,0);var f=$(g).clone().attr("class","product-delaunay").attr("transform",e+k);$(i[0]).append(f);meshu.mesh().refresh()}else{if(m=="earrings"||m=="pendant"){var f=$(g).clone().attr("class","product-delaunay").attr("transform",h>1.5?j:e);$(i[0]).append(f)}}}};a.previewFromElement=function(f,e){var c=d3.select("#preview-"+f),d=sb.transforms.getTransform(f,"product");c.append("svg:image").attr("x",0).attr("y",0).attr("width","600px").attr("height","600px").attr("class","product-delaunay").attr("transform",d).attr("xlink:href",e.toDataURL())};a.rotation=function(c){d3.selectAll(".product-delaunay").attr("transform",function(g,f){var e=sb.transforms.getTransform(b[f].type,"product");return e+" rotate("+c+", 300, 300)"})};return a}()});