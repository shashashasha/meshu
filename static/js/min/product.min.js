var sb=sb||{};$(function(){sb.product=function(){var a={};var b=[];a.initialize=function(f,c){b=c.getProducts();console.log("initialize");var e={};for(var g=0;g<b.length;g++){var h=b[g];a.resetPreviewImage(h.type);if(typeof f=="string"){a.previewFromSelector(h.type,f)}else{a.previewFromElement(h.type,f)}e[h.type]=true;var d=a.describeProductRange(h);$("#range-"+h.type).html(d)}$("#product-preview .wrapper").each(function(j,k){var l=k.id.split("-").pop();if(!e[l]){$(k).hide()}})};a.resetPreviewImage=function(d){var c=d3.select("#preview-"+d);c.select(".product-delaunay").remove()};a.previewFromSelector=function(f,e){var c=d3.select("#preview-"+f),d=sb.transforms.getTransform(f,"product");var g=$(e).clone().attr("class","product-delaunay").attr("transform",d);$(c[0]).append(g)};a.previewFromElement=function(f,e){var c=d3.select("#preview-"+f),d=sb.transforms.getTransform(f,"product")};a.range=function(c){return c.length==1?"$"+c[0]:"$"+c[0]+"-"+c[c.length-1]};a.describeProductRange=function(d){if(d.discount!=undefined){var c="<del>"+a.range(d.originals)+"</del>";c+=" "+a.range(d.prices);c+=d.discount<1?" ("+Math.floor((1-d.discount)*100)+"% off!)":" ($"+d.discount+" off!)";return c}else{return a.range(d.prices)}};a.attachMeshu=function(e,d,c){};a.thumbnail=function(f,e,c){var d=$(f).clone().attr("class","product-delaunay").attr("transform",c);d3.select(e[0]).append("svg:rect").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%");e.append(d)};a.rotation=function(c){d3.selectAll(".product-delaunay").attr("transform",function(g,f){var e=sb.transforms.getTransform(b[f].type,"product");return e+" rotate("+c+", 300, 300)"})};return a}()});