var sb=sb||{};$(function(){sb.product=function(){var a={};var b=[];a.initialize=function(d,c){b=c.getProducts();for(var e=0;e<b.length;e++){var f=b[e];a.resetPreviewImage(f.type);if(typeof d=="string"){a.previewFromSelector(f.type,d,"#preview-"+f.type)}else{a.previewFromElement(f.type,d)}}};a.resetPreviewImage=function(d){var c=d3.select("#preview-"+d);c.select(".product-transformer").remove()};a.previewFromSelector=function(j,f,l){var i=d3.select(l).append("g").attr("class","product-transformer"),m=meshu.mesh(),h=m.projectPoints(m.getLongestRotation()),g=h.width/h.height,e=sb.transforms.getTransform(j,"product"),k=-m.getRotationAngle(),c=0,d=0;switch(j){case"cufflinks":c=450;d=400;break;case"necklace":c=450;d=450/g;if(g>2){d=(450/g)*1.5;k=0}break;case"earrings":case"pendant":default:c=450;d=450/g;if(g>2){d=(450/g)*2;k=90}break}m.transformedDelaunay(h,c,d);a.cloneSVG(i[0],f,c,d);i.attr("transform",e+" rotate("+k+")");m.refresh();return i};a.cloneSVG=function(f,d,c,e){var g=$(d).clone().attr("class","product-delaunay").attr("transform","translate(-"+c/2+", -"+e/2+")");$(f).append(g)};a.previewFromElement=function(h,e){var c=d3.select("#preview-"+h),d=sb.transforms.getTransform(h,"product");var f=c.append("g").attr("class","product-transformer").attr("transform",d);f.append("svg:image").attr("x",0).attr("y",0).attr("width","600px").attr("height","600px").attr("class","product-delaunay").attr("transform","translate(-300, -300)").attr("xlink:href",e.toDataURL())};a.rotation=function(c){d3.selectAll(".product-delaunay").attr("transform",function(g,f){var e=sb.transforms.getTransform(b[f].type,"product");return e+" rotate("+c+", 300, 300)"})};return a}()});