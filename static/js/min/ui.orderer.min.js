var sb=sb||{};sb.ui=sb.ui||{};sb.ui.orderer=function(d,a){var c=d3.dispatch("validated","updated");c.on("updated",function(){b()});$("#shipping-destination li").click(function(){var i=$(this).attr("id").split("-").pop();var h=$("#shipping-destination");$("#shipping-form").attr("class",i);h.find("li").removeClass("active");$(this).addClass("active");cashier.shippingMode(i)});$("#postcard-note-form").keyup(function(i){var h=i.target.value;$("#postcard-note").val(h)});$("#coupon-code").submit(function(){var h=$("#coupon-code-value").val();cashier.applyCoupon(h,function(k){if(k.success){var l=parseFloat(k.amount);if(l<1&&l>0){var i=Math.round(cashier.getPrice()*(1-l));var j=Math.round((1-l)*100);$("<h2>").attr("id","subtotal-coupon").addClass("review-header").html("Coupon:<span>"+j+"% off! -$"+i+".00</span>").insertAfter("#subtotal-price")}else{if(l>1){$("<h2>").attr("id","subtotal-coupon").addClass("review-header").html("Coupon:<span>-$"+l+".00</span>").insertAfter("#subtotal-price")}}$("#coupon-message").fadeIn("fast").html(h+" discount applied!");$(".coupon-form").hide();$("#coupon").val(h)}else{$("#coupon-message").fadeIn("fast").html("Invalid code.")}c.updated()});return false});var f=$("#payment-form").validate({rules:{card_number:{creditcard:true},card_cvc:{digits:true,minlength:3},card_month:{digits:true,minlength:2},card_year:{digits:true,minlength:4,}},messages:{shipping_state:"Please enter the two-letter state abbreviation.",card_cvc:"Sorry, that is not a valid CVC code",card_month:{minlength:"Please enter the month as a two-digit number."},card_year:{minlength:"Please enter the year as a four-digit number.",},},submitHandler:e});$("#save-and-view").click(function(){var h=function(){saver.createOrUpdateMeshu(function(i){window.location.href=i.meshu_url})};if(!user.loggedIn){g();user.afterLogIn=h}else{h()}});$("#review-button").click(function(){if(!user.loggedIn){g();return false}saver.createOrUpdateMeshu()});$("#add-to-cart").click(function(){c.updated();$("#order-form")[0].submit()});function e(){if(!user.loggedIn){g(e);return}c.updated();c.validated();return false}function g(h){user.showModal();user.afterLogIn=function(){if(h){saver.createOrUpdateMeshu(function(){setTimeout(h,200)})}}}function b(){var j=sb.materializer.product(),h=sb.materializer.material(),i=a.getPrice(j,h)*100;$("#object-type").val(j);$("#object-material").val(h);$("#object-color").val(sb.materializer.color().toLowerCase());$("#object-amount").val(i);$("#svg-theta").val(sb.rotator?sb.rotator.rotation():0);$("#svg-file").val(d.outputSVG());$("#meshu-data").val(d.outputLocationData());$("#meshu-title").val(loadedMeshu?loadedMeshu.title:d.outputTitle());$("#meshu-renderer").val(d.mesh().name);$("#meshu-metadata").val(d.mesh().outputStyle());$("#postcard-note").val($("#postcard-note-form").val())}return c};