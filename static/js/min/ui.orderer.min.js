var sb=sb||{};sb.ui=sb.ui||{};sb.ui.orderer=function(){var d=d3.dispatch("updated"),e=null,b=null,f={};d.on("updated",function(){c();a()});d.initialize=function(i,j){e=i,b=j;$("#postcard-note-form").keyup(function(l){var k=l.target.value;$("#postcard-note").val(k)});$("#save-and-view").click(function(){var k=function(){saver.createOrUpdateMeshu(function(l){window.location.href=l.meshu_url})};if(!user.loggedIn){h();user.afterLogIn=k}else{k()}});$("#add-to-cart").click(function(){d.updated();$("#order-form")[0].submit()})};function g(){if(!user.loggedIn){h(g);return}d.updated();d.validated();return false}function h(i){user.showModal();user.afterLogIn=function(){if(i){saver.createOrUpdateMeshu(function(){setTimeout(i,200)})}}}function c(){var l=sb.materializer.product(),j=sb.materializer.material(),i=sb.materializer.color(),k=b.getPrice(l,j)*100;$("#object-type").val(l);$("#object-material").val(j);$("#object-color").val(i?i.toLowerCase():"");$("#object-amount").val(k);$("#svg-theta").val(sb.rotator?sb.rotator.rotation():0);$("#svg-file").val(e.outputSVG());$("#meshu-data").val(e.outputLocationData());$("#meshu-title").val(loadedMeshu?loadedMeshu.title:e.outputTitle());$("#meshu-renderer").val(e.mesh().name);$("#meshu-metadata").val(e.mesh().outputStyle());$("#postcard-note").val($("#postcard-note-form").val());$("#order-metadata").val(d.outputMetadata())}function a(){var o=sb.materializer.product(),l=sb.materializer.material(),j=sb.materializer.color(),n=b.getPrice(o,l),m=e.mesh().name,i=$("#review");var p=$("#product-preview .product-delaunay:first").clone().attr("class","review-delaunay").attr("transform","scale(.25)");i.find(".review-svg").empty().append(p);if(o){if(o=="ring"){var k=sb.ui.orderer.metadata().ringSize?sb.ui.orderer.metadata().ringSize:"<span class='inactive'>not chosen</span>";i.find(".review-product").removeClass("inactive").html(o+" â€” size "+k)}else{i.find(".review-product").removeClass("inactive").text(o)}}if(j&&l){i.find(".review-material").removeClass("inactive").text(sb.materializer.color()+" "+l)}else{i.find(".review-material").addClass("inactive").text("not chosen")}if(o&&j&&l){i.find(".review-price").html("<span class='dollar'>$</span>"+n+".00");i.find(".review-make-time").text(b.getMakeTime(l));if(m=="facet"&&p.children().length||m=="radial"&&$(".meshu-svg .radial").children().length){if(o=="ring"&&!sb.ui.orderer.metadata().ringSize){return}i.find("#add-to-cart").removeClass("inactive")}}}d.metadata=function(k){if(!arguments.length){return f}for(var j in k){f[j]=k[j]}};d.clearMetadata=function(i){if(f[i]){delete f[i]}};d.outputMetadata=function(){var k=[];for(var j in f){k.push(j+":"+f[j])}return k.join("|")};return d}();