var sb=sb||{};sb.ui=sb.ui||{};sb.ui.orderer=function(){var d=d3.dispatch("updated"),e=null,b=null;d.on("updated",function(){c();a()});d.initialize=function(h,i){e=h,b=i;$("#postcard-note-form").keyup(function(k){var j=k.target.value;$("#postcard-note").val(j)});$("#save-and-view").click(function(){var j=function(){saver.createOrUpdateMeshu(function(k){window.location.href=k.meshu_url})};if(!user.loggedIn){g();user.afterLogIn=j}else{j()}});$("#add-to-cart").click(function(){d.updated();$("#order-form")[0].submit()})};function f(){if(!user.loggedIn){g(f);return}d.updated();d.validated();return false}function g(h){user.showModal();user.afterLogIn=function(){if(h){saver.createOrUpdateMeshu(function(){setTimeout(h,200)})}}}function c(){var k=sb.materializer.product(),i=sb.materializer.material(),h=sb.materializer.color(),j=b.getPrice(k,i)*100;$("#object-type").val(k);$("#object-material").val(i);$("#object-color").val(h?h.toLowerCase():"");$("#object-amount").val(j);$("#svg-theta").val(sb.rotator?sb.rotator.rotation():0);$("#svg-file").val(e.outputSVG());$("#meshu-data").val(e.outputLocationData());$("#meshu-title").val(loadedMeshu?loadedMeshu.title:e.outputTitle());$("#meshu-renderer").val(e.mesh().name);$("#meshu-metadata").val(e.mesh().outputStyle());$("#postcard-note").val($("#postcard-note-form").val());$("#order-metadata").val()}function a(){var j=sb.materializer.product(),h=sb.materializer.material(),i=b.getPrice(j,h);if(j){$(".review-product").removeClass("inactive").text(j)}if(sb.materializer.color()&&h){$(".review-material").removeClass("inactive").text(sb.materializer.color()+" "+h)}if(j&&sb.materializer.color()&&h){$(".review-price").text("$"+i+".00");$("#add-to-cart").removeClass("inactive")}}return d}();