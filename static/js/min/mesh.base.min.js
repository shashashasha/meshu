var sb=sb||{};sb.mesh={};sb.mesh.base=function(d,w,j,g){var f=d3.dispatch("added","refreshed","locationsSet","removed","draggedMap","draggedPoint","clickedMap","clickedPoint","styled","interactiveToggled"),l=parseInt(Math.random()*10000000000,10);f.dirty=true;var r=[],c=[],e=[],s={};var q=[],p=[],k=[],x=0,i=null,b=false,v=null,h=null,t=null,a=null;var o=$("#content");d3.select(".frame").on("mousemove",u).on("mousedown",m);d3.select("body").on("mouseup",n);function m(){if(!o.hasClass("edit")){return}v=true}function u(){if(!o.hasClass("edit")){return}if(!f.dragging&&!v){return}var y=d3.svg.mouse(d);if(f.dragging){var z=w.p2l({x:y[0],y:y[1]});f.draggedPoint(f.dragging,z)}if(b&&v){h=true;if(t){w.map.panBy({x:y[0]-t[0],y:y[1]-t[1]})}f.dirty=true;f.draggedMap()}b=true;t=y}function n(){v=null;t=null;if(!o.hasClass("edit")){return}if(d3.event.target.tagName!="circle"&&f.hittest(d3.event.target)&&d3.event.target.tagName!="image"){return}if(!f.dragging&&!h){var y=d3.svg.mouse(d);var z=w.p2l({x:y[0],y:y[1]});f.clickedMap(z);h=null;return}if(!b&&f.dragging){f.clickedPoint(f.dragging)}else{u()}if(d3.event){d3.event.preventDefault();d3.event.stopPropagation()}b=false;f.dragging=null;h=null}f.interactive=function(y){f.interactiveToggled(y)};f.refresh=function(){update();f.refreshed()};f.prerender=function(){};f.applyStyle=function(y){var B=y.split("|");var A={};for(var z=0;z<B.length;z++){var C=B[z].split(":");A[C[0]]=C[1]}f.style(A)};f.style=function(z){if(!arguments.length){return s}for(var y in z){s[y]=z[y]}f.styled(s)};f.outputStyle=function(){var z=[];for(var y in s){z.push(y+":"+s[y])}return z.join("|")};f.updateTitle=function(y){a=y};f.outputTitle=function(){return a||"My Meshu"};f.output=function(){return $("#"+l).html()};f.outputMesh=function(){return".delaunay"};return f};