$(function(){var a=d3.dispatch("validated","updated");$("#shipping-destination li").click(function(){var e=$(this).attr("id").split("-").pop();var d=$("#shipping-destination");$("#shipping-form").attr("class",e);d.find("li").removeClass("active");$(this).addClass("active");cashier.shippingMode(e)});$("#coupon-code").submit(function(){var d=$("#coupon-code-value").val();cashier.applyCoupon(d,function(g){if(g.success){var h=parseFloat(g.amount);if(h<1&&h>0){var e=Math.round(cashier.getPrice()*(1-h));var f=Math.round((1-h)*100);$("<h2>").attr("id","subtotal-coupon").addClass("review-header").html("Coupon:<span>"+f+"% off! -$"+e+".00</span>").insertAfter("#subtotal-price")}else{if(h>1){$("<h2>").attr("id","subtotal-coupon").addClass("review-header").html("Coupon:<span>-$"+h+".00</span>").insertAfter("#subtotal-price")}}$("#coupon-message").fadeIn("fast").html(d+" discount applied!");$(".coupon-form").hide();$("#coupon").val(d)}else{$("#coupon-message").fadeIn("fast").html("Invalid code.")}a.updated()});return false});var c=$("#payment-form").validate({rules:{card_number:{creditcard:true},card_cvc:{digits:true,minlength:3},card_month:{digits:true,minlength:2},card_year:{digits:true,minlength:4,}},messages:{shipping_state:"Please enter the two-letter state abbreviation.",card_cvc:"Sorry, that is not a valid CVC code",card_month:{minlength:"Please enter the month as a two-digit number."},card_year:{minlength:"Please enter the year as a four-digit number.",},},submitHandler:b});$("#submit-button").click(function(d){console.log("submitting");$("#payment-form")[0].submit()});function b(){console.log("submit validated");a.updated();a.validated();return false}return a});