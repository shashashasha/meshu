$(function(){var h=$("html").hasClass("svg");var a=loadedMeshu?loadedMeshu.promo:null,e=loadedMeshu?loadedMeshu.renderer:$("body").hasClass("radial")?"radial":null;var f=sb.catalog(a);orderer.catalog(f);sb.materializer.initialize(f);meshu=sb.meshu($("#meshu-container")[0],e);meshu.zoomOffset=window.location.href.search("postcard")>0?-0.25:-1;meshu.isReadymade=loadedMeshu&&loadedMeshu.product!="";var c=sb.ui.orderer(meshu);c.on("validated",function(){sb.viewhandler.view("review");d("review");return false});sb.ui.socialsharer(meshu);sb.viewhandler.initialize();if(loadedMeshu){saver.initialize(meshu);saver.updateMeshuData(loadedMeshu);user.updateLogoutActions(pageType);sb.viewhandler.updateViews(pageType);switch(pageType){case"view":if(h){meshu.map().buffer(0)}break;case"product":var g=$("#product");g.find(".nav").remove();g.find(".make-wrapper").removeClass("make-wrapper");break;default:$("#materials").addClass("ready");var g=loadedMeshu.product.length?loadedMeshu.product:"necklace";sb.materializer.product(g);break}if(h){if(meshu.isReadymade&&readymade){readymade.initialize(meshu)}meshu.initializeFromData(loadedMeshu.location_data,loadedMeshu.metadata,loadedMeshu.svg)}switch(e){case"facet":sb.product.initialize(".delaunay",f);break;case"radial":sb.product.initialize(loadedMeshu.svg,f);break}$("#finish-button").addClass("active");$("#meshu-container").removeClass("inactive");var i=loadedMeshu.location_data.split("|");$.each(i,function(k,m){var l=m.split("\t");if(l.length==3){var n=document.createElement("div");n.innerHTML=l[2];var j=n.firstChild.nodeValue;$("<li>").html(j).appendTo($("#display-places"))}});d3.select("#place-number").attr("class","").select(".title-text").html(function(j){j.title=loadedMeshu.title;meshu.updateTitle(j.title);return j.title})}else{saver.initializeNewMeshu(meshu)}sb.viewhandler.updateAccountView();sb.viewhandler.on("next",d);sb.viewhandler.on("prev",b);if(!user.loggedIn&&!loadedMeshu&&window.location.hash!="#skipintro"){$(".tooltip").each(function(j,k){setTimeout(function(){$(k).fadeIn()},j*1000)});$(document).click(function(){$(".tooltip").fadeOut()})}$("#product-preview svg").live("click",function(){var j=$(this).attr("id").split("-")[1];$(".make-option").hide();$("#make-"+j).show();sb.rotator.update(j);sb.materializer.product(j);sb.rotator.on("rotated",sb.product.rotation)});function d(){var j=sb.viewhandler.view();switch(j){case"edit":meshu.updateBounds();meshu.mesh().interactive(true);if(meshu.mesh().name=="facet"){sb.product.initialize(".delaunay",f)}else{if(meshu.mesh().name=="radial"){console.log("rasterizing thumbnail for the products");sb.rasterizer.thumbnail(meshu,function(o){console.log(o);sb.product.initialize($(o),f)})}}console.log("rasterizing",meshu);sb.rasterizer.rasterize(meshu);break;case"make":case"readymade":meshu.mesh().interactive(false);var m=sb.materializer.product();var l=sb.transforms[m]["render"];meshu.animateTransform(sb.rotator?sb.rotator.rotation():0,l.scale,l.transform.x,l.transform.y);d3.select(".delaunay").attr("class","delaunay "+m);var n=static_url+"images/render/"+m+"_preview.jpg",k="url("+n+")";$(".render").css("background-image",k);break;case"review":c.updated();break}}function b(){var j=sb.viewhandler.view();switch(j){case"edit":meshu.mesh().interactive(true);break;case"make":case"readymade":meshu.mesh().interactive(true);meshu.animateTransform(0,1,0,0);break}}$(".show-places").click(function(){$("#display-places").slideToggle();$(".show-places").toggle()})});