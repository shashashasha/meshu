$(function(){var j=$("html").hasClass("svg");var a=loadedMeshu?loadedMeshu.promo:null,f=loadedMeshu&&loadedMeshu.product!="",i=window.location.href.search("postcard")>0?-0.25:0,e=loadedMeshu?loadedMeshu.renderer:$("body").hasClass("radial")?"radial":null;if($("body").hasClass("print")){e="print"}var g=sb.catalog(e,a);cashier.catalog(g);sb.materializer.initialize(g);meshu=sb.meshu($("#meshu-container")[0],e);meshu.zoomOffset=i;meshu.isReadymade=f;var c=sb.ui.orderer(meshu);c.on("validated",function(){sb.viewhandler.view("review");d("review");return false});sb.ui.socialsharer(meshu);if(loadedMeshu){saver.initialize(meshu);saver.updateMeshuData(loadedMeshu);user.updateLogoutActions(pageType);console.log(pageType);switch(pageType){case"view":if(j){meshu.map().buffer(0)}break}if(j){if(meshu.isReadymade&&readymade){readymade.initialize(meshu)}meshu.initializeFromData(loadedMeshu.location_data,loadedMeshu.metadata,loadedMeshu.svg)}if(pageType!="postcard"){h()}$("#finish-button").addClass("active");$("#meshu-container").removeClass("inactive");var k=loadedMeshu.location_data.split("|");$.each(k,function(m,o){var n=o.split("\t");if(n.length==3){var p=document.createElement("div");p.innerHTML=n[2];var l=p.firstChild.nodeValue;$("<li>").html(l).appendTo($("#display-places"))}});d3.select("#places").attr("class","").select("#place-title").attr("class","").select(".title-text").html(function(l){l.title=loadedMeshu.title;meshu.updateTitle(l.title);return l.title})}else{saver.initializeNewMeshu(meshu)}sb.viewhandler.updateAccountView();sb.viewhandler.on("next",d);sb.viewhandler.on("prev",b);if(!user.loggedIn&&!loadedMeshu&&window.location.hash!="#skipintro"){$(".tooltip").each(function(l,m){setTimeout(function(){$(m).fadeIn()},l*1000)});$(document).click(function(){$(".tooltip").fadeOut()})}$("#product-preview .wrapper").live("click",function(){var m=$(this);m.parent().find(".wrapper").removeClass("selected");m.addClass("selected");var l=m.attr("id").split("-")[1];sb.rotator.update(l);sb.materializer.product(l)});function h(){if(meshu.mesh().name=="facet"){sb.product.initialize(".delaunay",g);sb.rasterizer.rasterize(meshu)}else{if(meshu.mesh().name=="radial"){sb.rasterizer.thumbnail(meshu,function(l){sb.product.initialize(l,g);sb.rasterizer.rasterize(meshu)})}}}function d(){var l=sb.viewhandler.view();switch(l){case"edit":meshu.updateBounds();meshu.mesh().interactive(true);h();break;case"make":case"readymade":meshu.mesh().interactive(false);var n=static_url+"images/render/"+product+"_preview.jpg",m="url("+n+")";$(".render").css("background-image",m);break}}function b(){var l=sb.viewhandler.view();switch(l){case"edit":meshu.mesh().interactive(true);break;case"make":case"readymade":meshu.mesh().interactive(true);meshu.animateTransform(0,1,0,0);break}}$(".show-places").click(function(){$("#display-places").slideToggle();$(".show-places").toggle()})});