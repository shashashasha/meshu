$(function(){var h=$("html").hasClass("svg");var d=loadedMeshu?loadedMeshu.renderer:"facet";$("body").hasClass("radial")?"radial":"facet";if($("body").hasClass("radial")){d="radial"}else{if($("body").hasClass("print")){d="print"}else{if($("body").hasClass("orbit")){d="orbit"}else{if($("body").hasClass("streets")){d="streets"}}}}var a=sb.catalog(d);sb.materializer.initialize(a);meshu=sb.meshu($("#meshu-container")[0],d);meshu.zoomOffset=window.location.href.search("postcard")>0?-0.25:0;meshu.isReadymade=loadedMeshu&&loadedMeshu.product!="";sb.ui.orderer.initialize(meshu,a);if(loadedMeshu){saver.initialize(meshu);saver.updateMeshuData(loadedMeshu);user.updateLogoutActions(pageType);switch(pageType){case"view":sb.ui.socialsharer(meshu);if(h){meshu.map().buffer(0)}break}if(h){if(meshu.isReadymade&&readymade){readymade.initialize(meshu)}meshu.initializeFromData(loadedMeshu.location_data,loadedMeshu.metadata,loadedMeshu.svg)}if(pageType!="postcard"&&pageType!="print"){b()}$("#meshu-container").removeClass("inactive");var g=loadedMeshu.location_data.split("|");$.each(g,function(k,m){var l=m.split("\t");if(l.length==3){var n=document.createElement("div");n.innerHTML=l[2];var j=n.firstChild.nodeValue;$("<li>").html(j).appendTo($("#display-places"))}});d3.select("#places").attr("class","").select("#place-title").attr("class","").select(".title-text").html(function(i){i.title=loadedMeshu.title;meshu.updateTitle(i.title);return i.title})}else{saver.initializeNewMeshu(meshu)}sb.viewhandler.on("next",e);sb.viewhandler.on("prev",f);var c=false;if(!user.loggedIn&&!loadedMeshu&&window.location.hash!="#skipintro"){$(".tooltip").each(function(j,k){setTimeout(function(){if(!c){$(k).fadeIn()}},j*1000)});$(document).click(function(){c=true;$(".tooltip").fadeOut()})}$("#product-preview .wrapper").live("click",function(){var l=$(this);l.parent().find(".wrapper").removeClass("selected");l.addClass("selected");var k=l.attr("id").split("-")[1];var j=sb.materializer.material(),i=sb.materializer.color();if(!(i+"-"+j in a.getMaterials(k))){sb.materializer.material("reset")}if(d=="print"){if(k!=sb.materializer.product()){$(".frame-wrapper").removeClass("selected").removeClass("possible")}$("#frame-"+k).addClass("possible");sb.materializer.material("unframed")}else{if(k.split("_")[1]=="poster"){$("#materials").fadeOut();$("#add-ons").fadeOut();$(".print-hide").fadeOut();sb.materializer.material("unframed");sb.materializer.color("null")}else{$("#materials").fadeIn();$("#add-ons").fadeIn();$(".print-hide").fadeIn()}}switch(k){case"small_poster":case"medium_poster":case"large_poster":case"cufflinks":$("#final-rotate").hide();$("#final-ring").hide();sb.ui.orderer.clearMetadata("ringSize");break;case"ring":$("#final-rotate").hide();$("#final-ring").show();sb.rotator.on("ringSizeUpdated",function(m){sb.ui.orderer.metadata({ringSize:m})});sb.rotator.updateRing();break;default:$("#final-rotate").show();$("#final-ring").hide();if(d=="facet"||d=="orbit"){sb.rotator.update(k);sb.rotator.on("rotated",function(){sb.ui.orderer.updated()})}sb.ui.orderer.clearMetadata("ringSize");break}if($("#product-preview").hasClass("dense")&&k=="pendant"){k="dense_pendant"}sb.materializer.product(k);sb.ui.orderer.updated()});function b(){if(meshu.mesh().name=="facet"){sb.product.initialize(".delaunay",a);var i=$("body").hasClass("ie9")||$("body").hasClass("ie10");if(!i){sb.rasterizer.ringPreview(meshu)}}else{if(meshu.mesh().name=="radial"||meshu.mesh().name=="streets"){sb.rasterizer.thumbnail(meshu,function(j){sb.product.initialize(j,a)})}else{if(meshu.mesh().name=="orbit"){sb.product.initialize(".delaunay",a)}}}}function e(){var i=sb.viewhandler.view();switch(i){case"edit":meshu.updateBounds();meshu.mesh().interactive(true);if(d=="print"){meshu.mesh().copyMap()}b();break;case"make":case"readymade":meshu.mesh().interactive(false);break}}function f(){var i=sb.viewhandler.view();switch(i){case"edit":meshu.mesh().interactive(true);break}}$(".show-places").click(function(){$("#display-places").slideToggle();$(".show-places").toggle()})});