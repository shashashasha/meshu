$(function(){var k=$("html").hasClass("svg");var a=loadedMeshu?loadedMeshu.promo:null,f=loadedMeshu&&loadedMeshu.product!="",j=window.location.href.search("postcard")>0?-0.25:0,e=loadedMeshu?loadedMeshu.renderer:$("body").hasClass("radial")?"radial":null;if($("body").hasClass("print")){e="print"}var g=sb.catalog(e,a);orderer.catalog(g);sb.materializer.initialize(g);meshu=sb.meshu($("#meshu-container")[0],e);meshu.zoomOffset=j;meshu.isReadymade=f;var c=sb.ui.orderer(meshu);c.on("validated",function(){sb.viewhandler.view("review");d("review");return false});sb.ui.socialsharer(meshu);sb.viewhandler.initialize();if(loadedMeshu){saver.initialize(meshu);saver.updateMeshuData(loadedMeshu);user.updateLogoutActions(pageType);sb.viewhandler.updateViews(pageType);switch(pageType){case"view":if(k){meshu.map().buffer(0)}break;case"product":var i=$("#product");i.find(".nav").remove();i.find(".make-wrapper").removeClass("make-wrapper");break;default:$("#materials").addClass("ready");var i=loadedMeshu.product.length?loadedMeshu.product:"necklace";sb.materializer.product(i);break}if(k){if(meshu.isReadymade&&readymade){readymade.initialize(meshu)}meshu.initializeFromData(loadedMeshu.location_data,loadedMeshu.metadata,loadedMeshu.svg)}if(pageType!="postcard"){h()}$("#finish-button").addClass("active");$("#meshu-container").removeClass("inactive");var l=loadedMeshu.location_data.split("|");$.each(l,function(n,p){var o=p.split("\t");if(o.length==3){var q=document.createElement("div");q.innerHTML=o[2];var m=q.firstChild.nodeValue;$("<li>").html(m).appendTo($("#display-places"))}});d3.select("#places").attr("class","").select("#place-title").attr("class","").select(".title-text").html(function(m){m.title=loadedMeshu.title;meshu.updateTitle(m.title);return m.title})}else{saver.initializeNewMeshu(meshu)}sb.viewhandler.updateAccountView();sb.viewhandler.on("next",d);sb.viewhandler.on("prev",b);if(!user.loggedIn&&!loadedMeshu&&window.location.hash!="#skipintro"){$(".tooltip").each(function(m,n){setTimeout(function(){$(n).fadeIn()},m*1000)});$(document).click(function(){$(".tooltip").fadeOut()})}$("#product-preview svg").live("click",function(){var m=$(this).attr("id").split("-")[1];$(".make-option").hide();$("#make-"+m).show();sb.rotator.update(m);sb.materializer.product(m);sb.rotator.on("rotated",sb.product.rotation)});function h(){if(meshu.mesh().name=="facet"){sb.product.initialize(".delaunay",g);sb.rasterizer.rasterize(meshu)}else{if(meshu.mesh().name=="radial"){sb.rasterizer.thumbnail(meshu,function(m){sb.product.initialize(m,g);sb.rasterizer.rasterize(meshu)})}}}function d(){var m=sb.viewhandler.view();switch(m){case"edit":meshu.updateBounds();meshu.mesh().interactive(true);h();break;case"make":case"readymade":meshu.mesh().interactive(false);var p=sb.materializer.product();var o=sb.transforms[p]["render"];meshu.animateTransform(sb.rotator?sb.rotator.rotation():0,o.scale,o.transform.x,o.transform.y);d3.select(".delaunay").attr("class","delaunay "+p);var q=static_url+"images/render/"+p+"_preview.jpg",n="url("+q+")";$(".render").css("background-image",n);break;case"review":c.updated();break}}function b(){var m=sb.viewhandler.view();switch(m){case"edit":meshu.mesh().interactive(true);break;case"make":case"readymade":meshu.mesh().interactive(true);meshu.animateTransform(0,1,0,0);break}}$(".show-places").click(function(){$("#display-places").slideToggle();$(".show-places").toggle()})});