var sb=sb||{};sb.map=function(d,c,i){var e=org.polymaps;var j=d3.dispatch("boundsUpdated"),g=0.5;var b="/proxy/tiles/{S}/{Z}/{X}/{Y}";var a=d3.select(d).append("div")[0][0];a.style.position="absolute";a.style.width=c;a.style.height=i;d3.select(d).append("div").attr("class","render");var f=e.image().url(e.url(b).hosts(["a","b","c","d"]));j.dispatch=d3.dispatch("show");var h=a.appendChild(e.svg("svg"));j.map=e.map().container(h).zoom(12).center({lat:37.755,lon:-122.445});j.map.size({x:$(d).width(),y:$(d).height()});j.map.add(f);d3.select(h).attr("width","100%").attr("height","100%").select("rect").attr("visibility","visible").attr("fill","white");j.frame=function(){return a};j.show=function(){if(!f.map()){j.map.add(f)}};j.hide=function(){if(f.map()){j.map.remove(f)}};j.buffer=function(k){g=k;return j};j.updateBounds=function(n,l,m){if(n.length==0||l.length==0){return}if(n.length==1&&l.length==1){j.map.center({lat:n[0],lon:l[0]}).zoom(10);return}var k=[{lat:d3.min(n),lon:d3.min(l)},{lat:d3.max(n),lon:d3.max(l)}];j.map.extent(k);m=m||0;j.map.zoom(Math.floor(j.map.zoom())+m);j.boundsUpdated()};j.resizeContainer=function(l,o){var t=[{lat:d3.min(l),lon:d3.min(o)},{lat:d3.max(l),lon:d3.max(o)}];j.map.zoom(10).center({lat:0,lon:0});var m=j.map.locationPoint(t[0]);var p=j.map.locationPoint(t[1]);var k=Math.abs(p.x-m.x);var s=Math.abs(p.y-m.y);var q=430;var n=k>s?q/k:q/s;k*=n;s*=n;a.style.width=(k)+"px";a.style.height=(s)+"px";j.map.extent(t);var r=j.l2p(t[0]).y-j.l2p(j.map.extent()[0]).y;if(r){a.style.top=(150-r)+"px"}};j.getBounds=function(){var l=j.map.extent();var k=j.map.locationPoint(l[0]);var m=j.map.locationPoint(l[1]);return{t:m.y,b:k.y,l:k.x,r:m.x}};j.l2p=function(k){return j.map.locationPoint(k)};j.p2l=function(k){return j.map.pointLocation(k)};return j};