var sb=sb||{};sb.map=function(d,c,h){var e=org.polymaps;var i=d3.dispatch("boundsUpdated");var b="http://{S}tile.stamen.com/toner/{Z}/{X}/{Y}.png";var a=d3.select(d).append("div")[0][0];a.style.position="absolute";a.style.width=c;a.style.height=h;d3.select(d).append("div").attr("class","render");var f=e.image().url(e.url(b).hosts(["a.","b.","c.","d.",""]));i.dispatch=d3.dispatch("show");var g=a.appendChild(e.svg("svg"));i.map=e.map().container(g).zoom(12).center({lat:37.755,lon:-122.445});i.map.size({x:$(d).width(),y:$(d).height()});i.map.add(f);d3.select(g).attr("width","100%").attr("height","100%").select("rect").attr("visibility","visible").attr("fill","white");i.frame=function(){return a};i.show=function(){if(!f.map()){i.map.add(f)}};i.hide=function(){if(f.map()){i.map.remove(f)}};i.updateBounds=function(l,k){if(l.length==0||k.length==0){return}if(l.length==1&&k.length==1){i.map.center({lat:l[0],lon:k[0]}).zoom(10);return}var j=[{lat:d3.min(l),lon:d3.min(k)},{lat:d3.max(l),lon:d3.max(k)}];i.map.extent(j);i.map.zoom(i.map.zoom()-0.5);i.boundsUpdated()};i.resizeContainer=function(k,n){var s=[{lat:d3.min(k),lon:d3.min(n)},{lat:d3.max(k),lon:d3.max(n)}];i.map.zoom(10).center({lat:0,lon:0});var l=i.map.locationPoint(s[0]);var o=i.map.locationPoint(s[1]);var j=Math.abs(o.x-l.x);var r=Math.abs(o.y-l.y);var p=430;var m=j>r?p/j:p/r;j*=m;r*=m;a.style.width=(j)+"px";a.style.height=(r)+"px";i.map.extent(s);var q=i.l2p(s[0]).y-i.l2p(i.map.extent()[0]).y;if(q){a.style.top=(150-q)+"px"}};i.getBounds=function(){var k=i.map.extent();var j=i.map.locationPoint(k[0]);var l=i.map.locationPoint(k[1]);return{t:l.y,b:j.y,l:j.x,r:l.x}};i.l2p=function(j){return i.map.locationPoint(j)};i.p2l=function(j){return i.map.pointLocation(j)};return i};