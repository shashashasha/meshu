var sb=sb||{};sb.map=function(e,d,l){var f=org.polymaps;var m=d3.dispatch("boundsUpdated"),h=0.5;var b="http://{S}.meshu.io/proxy/tiles/{S}/{Z}/{X}/{Y}";var a=d3.select(e).append("div")[0][0];a.style.position="absolute";a.style.width=d;a.style.height=l;d3.select(e).append("div").attr("class","render");var g=f.image().url(f.url(b).hosts(["a","b","c","d"]));m.dispatch=d3.dispatch("show");var j=[{name:"San Francisco",lat:37.775,lon:-122.43,zoom:13},{name:"New York City",lat:40.718,lon:-73.997,zoom:14},{name:"London",lat:51.506325,lon:-0.127144,zoom:13},{name:"Paris",lat:48.85693,lon:2.3412,zoom:14},{name:"Moscow",lat:55.75695,lon:37.614975,zoom:14},{name:"Montreal",lat:45.512303,lon:-73.554431,zoom:13},{name:"Tokyo",lat:35.7,lon:139.774414,zoom:14}];var k=a.appendChild(f.svg("svg"));var i=Math.floor(Math.random()*j.length);m.map=f.map().container(k).zoom(j[i].zoom).center({lat:j[i].lat,lon:j[i].lon});m.map.size({x:$(e).width(),y:$(e).height()});m.map.add(g);d3.select(k).attr("width","100%").attr("height","100%").select("rect").attr("visibility","visible").attr("fill","white");m.frame=function(){return a};m.show=function(){if(!g.map()){m.map.add(g)}};m.hide=function(){if(g.map()){m.map.remove(g)}};m.buffer=function(c){h=c;return m};m.updateBounds=function(q,o,p){if(q.length==0||o.length==0){return}if(q.length==1&&o.length==1){m.map.center({lat:q[0],lon:o[0]});m.boundsUpdated();return}var c=[{lat:d3.min(q),lon:d3.min(o)},{lat:d3.max(q),lon:d3.max(o)}];m.map.extent(c);p=p||0;var n=Math.floor(m.map.zoom())+p;if(n!=m.map.zoom()){m.map.zoom(n)}m.boundsUpdated()};m.resizeContainer=function(n,q){var v=[{lat:d3.min(n),lon:d3.min(q)},{lat:d3.max(n),lon:d3.max(q)}];m.map.zoom(10).center({lat:0,lon:0});var o=m.map.locationPoint(v[0]);var r=m.map.locationPoint(v[1]);var c=Math.abs(r.x-o.x);var u=Math.abs(r.y-o.y);var s=430;var p=c>u?s/c:s/u;c*=p;u*=p;a.style.width=(c)+"px";a.style.height=(u)+"px";m.map.extent(v);var t=m.l2p(v[0]).y-m.l2p(m.map.extent()[0]).y;if(t){a.style.top=(150-t)+"px"}};m.getBounds=function(){var n=m.map.extent();var c=m.map.locationPoint(n[0]);var o=m.map.locationPoint(n[1]);return{t:o.y,b:c.y,l:c.x,r:o.x}};m.getMapRadius=function(){var c=m.map.extent();return{lat:Math.abs(c[0].lat-c[1].lat)/3,lon:Math.abs(c[0].lon-c[1].lon)/3}};m.l2p=function(c){return m.map.locationPoint(c)};m.p2l=function(c){return m.map.pointLocation(c)};return m};