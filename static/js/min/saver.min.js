var saver=function(){var b={};function e(){return{xhr:"true",title:b.meshu.outputTitle(),svg:b.meshu.outputSVG(),location_data:b.meshu.outputLocationData()}}function d(f){if(!f){return}b.meshu.id=f;if($("#meshu-id").length==0){$("#hidden-form-values").append('<input type="hidden" id="meshu-id" name="meshu_id" />')}$("#meshu-id").val(f)}function a(){var f=e();f.csrfmiddlewaretoken=$("#csrf input").val();if($("#meshu-id").length){f.id=b.getMeshuID()}$.post("/make/assign/",f,function(g){d(g.meshu_id);if(b.postAssignCallback){b.postAssignCallback(g)}},"json")}function c(){var f=e();f.csrfmiddlewaretoken=$("#csrf input").val();if($("#meshu-id").length){f.id=b.getMeshuID()}$.post("/make/create/",f,function(g){d(g.meshu_id);if(b.postCreateCallback){b.postCreateCallback(g)}},"json")}b.initialize=function(f){b.meshu=f;$("#cancel-button").click(function(){window.location.href=loadedMeshu.view_url});$("#save-button").click(function(){if(!loadedMeshu){return}$("#save-button").html("saving");var g=loadedMeshu.edit_url+"save";$.get(g,e(),function(h){d(h.meshu_id);setTimeout(function(){$("#save-button").html("saved!")},200);setTimeout(function(){window.location.href=h.meshu_url},1000)},"json")});$("#update-button").click(function(){if(!loadedMeshu){return}$("#update-button").html("updating");var g=loadedMeshu.edit_url+"update";$.get(g,e(),function(h){d(h.meshu_id);setTimeout(function(){$("#update-button").html("saved!")},200);setTimeout(function(){window.location.href=h.meshu_url},1000)},"json")});return b};b.initializeNewMeshu=function(f){b.meshu=f;return b};b.createOrUpdateMeshu=function(f){if(b.meshu.isReadymade&&f){f()}else{if(b.meshu.username&&b.meshu.username=="guest"){a();if(f){b.postAssignCallback=f}}else{c();if(f){b.postCreateCallback=f}}}return b};b.updateMeshuData=function(f){d(f.id);b.meshu.view_url=f.view_url;b.meshu.username=f.username;if(f.image_url){b.meshu.image_url=f.image_url}};b.getMeshuID=function(){return $("#meshu-id").val()};return b}();