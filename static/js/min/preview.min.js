var sb=sb||{};$(function(){sb.rotator=function(e,d,b){var c=d3.dispatch("rotated");var f=0,g="scale(.125) translate(380, 670) ";c.update=function(u){$(e).empty();var m=d3.select(e);var l=m.append("svg:image").attr("id","previewImage").attr("x",0).attr("y",0).attr("width",313).attr("height",297).attr("xlink:href",c.getImage(u));var h=m.append("svg:g").attr("id","transform").attr("transform",c.getTransform(u));var k=$(d).clone().attr("id","mini-delaunay");var i=$(b).clone().attr("id","rotate-ui");$(h[0]).append(k).append(i);if(u=="pendant"){m.select("#rotate-ui").attr("class","hidden pendant").selectAll("circle").attr("r","55")}d3.selectAll("circle.rotation").on("mousedown",q);m.on("mouseup",n).on("mousemove",s);var p,o,x,w,j,r,t,v;var r=0;function q(){var y=d3.svg.mouse(m.node());p=y[0]-100,o=y[1]-100;t=true}function s(){if(!t){return}var y=d3.svg.mouse(m.node());x=y[0]-100,w=y[1]-100;v=a(p,o,x,w);var A=Math.sqrt(Math.pow(p,2)+Math.pow(o,2));var z=Math.sqrt(Math.pow(x,2)+Math.pow(w,2));j=Math.acos((p*x+o*w)/(A*z))*180/Math.PI;f=v?(f-j)%360:(f+j)%360;if(isNaN(f)){f=0}p=x,o=w;c.rotated(f);h.attr("transform",c.getTransform(u))}function n(){t=false;if(d3.event){d3.event.preventDefault();d3.event.stopPropagation()}}};c.getTransform=function(h){return sb.transforms.getTransform(h,"product")+" rotate("+f+",300,300)"};c.getImage=function(h){return static_url+"images/preview/preview_"+h+".png"};c.rotation=function(h){if(!arguments.length){return f}f=h;return c};function a(i,k,h,j){if(h>i){if(k>0&&j>0){return true}else{return false}}else{if(h<i){if(k<0&&j<0){return true}else{return false}}else{if(j<k){if(i>0){return true}else{return false}}else{if(i<0){return true}else{return false}}}}}return c}("#rotate",".delaunay",".hidden")});