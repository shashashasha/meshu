var sb=sb||{};$(function(){sb.rotator=function(d,c,a){var b=d3.dispatch("rotated","ringSizeUpdated");var e=0,f="scale(.125) translate(380, 670) ";b.update=function(n){$(d).empty();e=e||sb.transforms.getDefaultRotation(n);var j=d3.select(d);var i=j.append("svg:image").attr("id","previewImage").attr("x",0).attr("y",0).attr("width",313).attr("height",297).attr("xlink:href",b.getImage(n));var g=j.append("svg:g").attr("id","transform").attr("transform",b.getTransform(n,"product",e));var h=$(c).clone().attr("class","mini-delaunay");$(g[0]).append(h);var l=0,k=1,p=0,o=0;var m;function q(s){if(m){clearInterval(m)}l=e;e=(e+s);var r=0;m=setInterval(function(){if(++r<30){l+=(e-l)*0.3;g.attr("transform",sb.transforms.getTransform(n,"product",l))}else{clearInterval(m)}},40)}$("#rotate-cw").click(function(){q(22.5)});$("#rotate-ccw").click(function(){q(-22.5)})};b.updateRing=function(){var g=$("#final-ring .frame").empty();var h=$(".ring-preview-frame").clone();$(g).append(h);var i=d3.scale.linear().domain([4,14]).range([0.8,1.2]);$("#ring-range").change(function(l){var j=l.currentTarget.value;$("#ring-number").text(j);b.ringSizeUpdated(j);sb.ui.orderer.updated();var k=i(j);h.css({"-moz-transform":"rotateX(15deg) rotateY(0deg) rotateZ(45deg) translate3d(0px,0px,0px) scale("+k+")","-webkit-transform":"rotateX(15deg) rotateY(0deg) rotateZ(45deg) translate3d(0px,0px,0px) scale("+k+")"})})};b.getTransform=function(g){return sb.transforms.getTransform(g,"product",e)};b.getImage=function(g){return static_url+"images/preview/preview_"+g+".png"};b.rotation=function(g){if(!arguments.length){return e%360}e=g;return b};return b}("#rotate",".delaunay",".hidden")});