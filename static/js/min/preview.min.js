var sb=sb||{};$(function(){sb.rotator=function(b,g,e){var j=d3.dispatch("rotated","ringSizeUpdated");var i=0,f="scale(.125) translate(380, 670) ",c,a;j.update=function(m){$(b).empty();a=m;i=i||sb.transforms.getDefaultRotation(a);console.log("default rotation",i);var l=d3.select(b);var o=l.append("svg:image").attr("id","previewImage").attr("x",0).attr("y",0).attr("width",313).attr("height",297).attr("xlink:href",j.getImage(a));c=l.append("svg:g").attr("id","transform").attr("transform",j.getTransform(a,"product",i));var n=$(g).clone().attr("class","mini-delaunay");$(c[0]).append(n)};var d=0,h;function k(m){if(h){clearInterval(h)}d=i;i=(i+m);var l=0;h=setInterval(function(){if(++l<30){d+=(i-d)*0.15;var n=sb.transforms.getTransform(a,"product",d);c.attr("transform",n)}else{clearInterval(h)}},40)}$("#rotate-cw").click(function(){k(22.5)});$("#rotate-ccw").click(function(){k(-22.5)});j.updateRing=function(){var l=$("#final-ring .frame").empty();var m=$(".ring-preview-frame").clone();$(l).append(m);var n=d3.scale.linear().domain([4,14]).range([0.8,1.2]);$("#ring-range").change(function(q){var o=q.currentTarget.value;$("#ring-number").text(o);j.ringSizeUpdated(o);sb.ui.orderer.updated();var p=n(o);m.css({"-moz-transform":"rotateX(15deg) rotateY(0deg) rotateZ(45deg) translate3d(0px,0px,0px) scale("+p+")","-webkit-transform":"rotateX(15deg) rotateY(0deg) rotateZ(45deg) translate3d(0px,0px,0px) scale("+p+")"})})};j.getTransform=function(l){return sb.transforms.getTransform(l,"product",i)};j.getImage=function(l){return static_url+"images/preview/preview_"+l+".png"};j.rotation=function(l){if(!arguments.length){return i%360}i=l;return j};return j}("#rotate",".delaunay",".hidden")});