var sb=sb||{};$(function(){sb.rotator=function(c,h,f){var k=d3.dispatch("rotated","ringSizeUpdated");var j=0,b=0,g="scale(.125) translate(380, 670) ",d,a;k.update=function(n){$(c).empty();a=n;b=meshu.mesh().getRotationAngle();j=b+sb.transforms.getDefaultRotation(a);console.log("default rotation",j,sb.transforms.getDefaultRotation(a));var m=d3.select(c);var o=m.append("svg:image").attr("id","previewImage").attr("x",0).attr("y",0).attr("width",313).attr("height",297).attr("xlink:href",k.getImage(a));d=sb.product.previewFromSelector(a,h,c)};var e=0,i;function l(n){if(i){clearInterval(i)}e=j;j=(j+n);var m=0;i=setInterval(function(){if(++m<30){e+=(j-e)*0.15;var o=sb.transforms.getTransform(a,"product",e-b);d.attr("transform",o)}else{clearInterval(i)}},40)}$("#rotate-cw").click(function(){l(22.5);k.rotated()});$("#rotate-ccw").click(function(){l(-22.5);k.rotated()});k.updateRing=function(){var m=$("#final-ring .frame").empty();var n=$(".ring-preview-frame").clone();$(m).append(n);var o=d3.scale.linear().domain([4,14]).range([0.8,1.2]);$("#ring-range").change(function(r){var p=r.currentTarget.value;$("#ring-number").text(p);k.ringSizeUpdated(p);sb.ui.orderer.updated();var q=o(p);n.css({"-moz-transform":"rotateX(15deg) rotateY(0deg) rotateZ(45deg) translate3d(0px,0px,0px) scale("+q+")","-webkit-transform":"rotateX(15deg) rotateY(0deg) rotateZ(45deg) translate3d(0px,0px,0px) scale("+q+")"})})};k.getTransform=function(m){return sb.transforms.getTransform(m,"product",j)};k.getImage=function(m){return static_url+"images/preview/preview_"+m+".png"};k.getRotation=function(){return(j)%360};k.getBaseRotation=function(){return b};return k}("#rotate",".delaunay",".hidden")});