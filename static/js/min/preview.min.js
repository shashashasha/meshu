var sb=sb||{};$(function(){sb.rotator=function(e,d,b){var c=d3.dispatch("rotated");var f=0,h="scale(.125) translate(380, 670) ";var g={earrings:"scale(.125) translate(650, 540)",pendant:"scale(.075) translate(1030, 1470)",necklace:"scale(.125) translate(510, 760)",cufflinks:"scale(.125) translate(510, 760)"};c.update=function(v){$(e).empty();var n=d3.select(e);var m=n.append("svg:image").attr("id","previewImage").attr("x",0).attr("y",0).attr("width",200).attr("height",190).attr("xlink:href",c.getImage(v));var i=n.append("svg:g").attr("id","transform").attr("transform",c.getTransform(v));var l=$(d).clone().attr("id","mini-delaunay");var j=$(b).clone().attr("id","rotate-ui");$(i[0]).append(l).append(j);if(v=="pendant"){n.select("#rotate-ui").attr("class","hidden pendant").selectAll("circle").attr("r","55")}d3.selectAll("circle.rotation").on("mousedown",r);n.on("mouseup",o).on("mousemove",t);var q,p,y,x,k,s,u,w;var s=0;function r(){var z=d3.svg.mouse(n.node());q=z[0]-100,p=z[1]-100;u=true}function t(){if(!u){return}var z=d3.svg.mouse(n.node());y=z[0]-100,x=z[1]-100;w=a(q,p,y,x);var B=Math.sqrt(Math.pow(q,2)+Math.pow(p,2));var A=Math.sqrt(Math.pow(y,2)+Math.pow(x,2));k=Math.acos((q*y+p*x)/(B*A))*180/Math.PI;f=w?(f-k)%360:(f+k)%360;if(isNaN(f)){f=0}q=y,p=x;c.rotated(f);i.attr("transform",c.getTransform(v))}function o(){u=false;if(d3.event){d3.event.preventDefault();d3.event.stopPropagation()}}};c.getTransform=function(i){return g[i]+" rotate("+f+",300,300)"};c.getImage=function(i){return static_url+"images/preview/preview_"+i+".png"};c.rotation=function(i){if(!arguments.length){return f}f=i;return c};function a(j,l,i,k){if(i>j){if(l>0&&k>0){return true}else{return false}}else{if(i<j){if(l<0&&k<0){return true}else{return false}}else{if(k<l){if(j>0){return true}else{return false}}else{if(j<0){return true}else{return false}}}}}return c}("#rotate",".delaunay",".hidden")});