var sb=sb||{};$(function(){sb.rotator=function(e,d,b){var c=d3.dispatch("rotated");var f=0,g="scale(.125) translate(380, 670) ";c.update=function(l){$(e).empty();var n=d3.select(e);var q=n.append("svg:image").attr("id","previewImage").attr("x",0).attr("y",0).attr("width",313).attr("height",297).attr("xlink:href",c.getImage(l));var p=n.append("svg:g").attr("id","transform").attr("transform",c.getTransform(l));var m=$(b).clone().attr("class","rotate-ui");var s=$(d).clone().attr("class","mini-delaunay");$(p[0]).append(s).append(m);if(l=="pendant"){n.select(".rotate-ui").attr("class","hidden pendant").selectAll("circle").attr("r","55")}d3.selectAll("circle.rotation").on("mousedown",x);n.on("mouseup",t).on("mousemove",k);var w,v,j,i,o,h,r,y;var h=0;function x(){var z=d3.svg.mouse(n.node());w=z[0]-100,v=z[1]-100;r=true}function k(){if(!r){return}var z=d3.svg.mouse(n.node());j=z[0]-100,i=z[1]-100;y=a(w,v,j,i);var B=Math.sqrt(Math.pow(w,2)+Math.pow(v,2));var A=Math.sqrt(Math.pow(j,2)+Math.pow(i,2));o=Math.acos((w*j+v*i)/(B*A))*180/Math.PI;f=y?(f-o)%360:(f+o)%360;if(isNaN(f)){f=0}w=j,v=i;p.attr("transform",c.getTransform(l))}function t(){r=false;if(d3.event){d3.event.preventDefault();d3.event.stopPropagation()}}function u(z){f=(f+z)%360;p.attr("transform",c.getTransform(l))}$("#rotate-cw").click(function(){u(22.5)});$("#rotate-ccw").click(function(){u(-22.5)})};c.updateRing=function(){var h=$("#final-ring .frame");var i=$(".ring-preview-frame").clone();$(h).append(i);sb.ui.orderer.metadata({ringSize:7});var j=d3.scale.linear().domain([4,14]).range([0.8,1.2]);$("#ring-range").change(function(m){var k=m.currentTarget.value;$("#ring-number").text(k);sb.ui.orderer.metadata({ringSize:k});var l=j(k);i.css({"-moz-transform":"rotateX(20deg) rotateY(0deg) rotateZ(45deg) translate3d(0px,0px,0px) scale("+l+")","-webkit-transform":"rotateX(20deg) rotateY(0deg) rotateZ(45deg) translate3d(0px,0px,0px) scale("+l+")"})})};c.getTransform=function(h){return sb.transforms.getTransform(h,"product")+" rotate("+f+",300,300)"};c.getImage=function(h){return static_url+"images/preview/preview_"+h+".png"};c.rotation=function(h){if(!arguments.length){return f}f=h;return c};function a(i,k,h,j){if(h>i){if(k>0&&j>0){return true}else{return false}}else{if(h<i){if(k<0&&j<0){return true}else{return false}}else{if(j<k){if(i>0){return true}else{return false}}else{if(i<0){return true}else{return false}}}}}return c}("#rotate",".delaunay",".hidden")});