var sb=sb||{};sb.catalog=function(f,d){var a={},e={},f=f||"facet";e.facet={earrings:{bamboo:{price:68,colors:["Amber"]},acrylic:{price:75,colors:["Black","White"]},nylon:{price:85,colors:["Black","White"]},silver:{price:145,colors:["Sterling Silver"]}},pendant:{bamboo:{price:68,colors:["Amber"]},acrylic:{price:80,colors:["Black","White"]},nylon:{price:85,colors:["Black","White"]},silver:{price:125,colors:["Sterling Silver"]}},necklace:{bamboo:{price:75,colors:["Amber"]},acrylic:{price:85,colors:["Black","White"]},nylon:{price:90,colors:["Black","White"]},silver:{price:145,colors:["Sterling Silver"]}},cufflinks:{silver:{price:145}}};e.radial={earrings:{bamboo:{price:75,colors:["Amber"]},acrylic:{price:80,colors:["Black","White"]},nylon:{price:90,colors:["Black","White"]}},pendant:{bamboo:{price:75,colors:["Amber"]},acrylic:{price:85,colors:["Black","White"]},nylon:{price:95,colors:["Black","White"]},silver:{price:160,colors:["Sterling Silver"]}}};var c=e[f];var b={};b.marathon={earrings:{bamboo:{price:64,colors:["Amber"],discount:0.85,originalPrice:75}},pendant:{bamboo:{price:64,colors:["Amber"],discount:0.85,originalPrice:75}},necklace:{bamboo:{price:68,colors:["Amber"],discount:0.85,originalPrice:80}}};if(d&&b[d]){c=b[d]}a.check=function(h,g){return c[h]&&c[h][g]};a.get=function(i,h,g){if(!c[i]||!c[i][h]){return"N/A"}return c[i][h][g]};a.getPrice=function(h,g){return a.get(h,g,"price")};a.getColors=function(h,g){return a.get(h,g,"colors")};if(d){a.getProducts=function(){var m=[];for(var k in c){var i=[],h=[],g=[],l=c[k];for(var j in l){i.push(l[j].price);if(l[j].originalPrice){h.push(l[j].originalPrice)}if(l[j].discount){g.push(l[j].discount)}}m.push({type:k,prices:i,originals:h,discount:g.length?g[0]:undefined})}return m}}else{a.getProducts=function(){var k=[];for(var i in c){var g=[],j=c[i];for(var h in j){g.push(j[h].price)}k.push({type:i,prices:g,discount:j.discount})}return k}}a.getMaterials=function(j){var g=[];for(var h in c[j]){g.push(h)}return g};return a};var sb=sb||{};sb.map=function(e,d,l){var f=org.polymaps;var m=d3.dispatch("boundsUpdated"),h=0.5;var b="/proxy/tiles/{S}/{Z}/{X}/{Y}";var a=d3.select(e).append("div")[0][0];a.style.position="absolute";a.style.width=d;a.style.height=l;d3.select(e).append("div").attr("class","render");var g=f.image().url(f.url(b).hosts(["a","b","c","d"]));m.dispatch=d3.dispatch("show");var j=[{name:"San Francisco",lat:37.775,lon:-122.43,zoom:13},{name:"New York City",lat:40.718,lon:-73.997,zoom:14},{name:"London",lat:51.506325,lon:-0.127144,zoom:13},{name:"Paris",lat:48.85693,lon:2.3412,zoom:14},{name:"Moscow",lat:55.75,lon:37.614975,zoom:14},{name:"Montreal",lat:45.512303,lon:-73.554431,zoom:13},{name:"Tokyo",lat:35.7,lon:139.774414,zoom:14}];var k=a.appendChild(f.svg("svg"));var i=Math.floor(Math.random()*j.length);m.map=f.map().container(k).zoom(j[i].zoom).center({lat:j[i].lat,lon:j[i].lon});m.map.size({x:$(e).width(),y:$(e).height()});m.map.add(g);d3.select(k).attr("width","100%").attr("height","100%").select("rect").attr("visibility","visible").attr("fill","white");m.frame=function(){return a};m.show=function(){if(!g.map()){m.map.add(g)}};m.hide=function(){if(g.map()){m.map.remove(g)}};m.buffer=function(c){h=c;return m};m.updateBounds=function(q,o,p){if(q.length==0||o.length==0){return}if(q.length==1&&o.length==1){m.map.center({lat:q[0],lon:o[0]});m.boundsUpdated();return}var c=[{lat:d3.min(q),lon:d3.min(o)},{lat:d3.max(q),lon:d3.max(o)}];m.map.extent(c);p=p||0;var n=Math.floor(m.map.zoom())+p;if(n!=m.map.zoom()){m.map.zoom(n)}m.boundsUpdated()};m.resizeContainer=function(n,q){var v=[{lat:d3.min(n),lon:d3.min(q)},{lat:d3.max(n),lon:d3.max(q)}];m.map.zoom(10).center({lat:0,lon:0});var o=m.map.locationPoint(v[0]);var r=m.map.locationPoint(v[1]);var c=Math.abs(r.x-o.x);var u=Math.abs(r.y-o.y);var s=430;var p=c>u?s/c:s/u;c*=p;u*=p;a.style.width=(c)+"px";a.style.height=(u)+"px";m.map.extent(v);var t=m.l2p(v[0]).y-m.l2p(m.map.extent()[0]).y;if(t){a.style.top=(150-t)+"px"}};m.getBounds=function(){var n=m.map.extent();var c=m.map.locationPoint(n[0]);var o=m.map.locationPoint(n[1]);return{t:o.y,b:c.y,l:c.x,r:o.x}};m.getMapRadius=function(){var c=m.map.extent();return{lat:Math.abs(c[0].lat-c[1].lat)/3,lon:Math.abs(c[0].lon-c[1].lon)/3}};m.l2p=function(c){return m.map.locationPoint(c)};m.p2l=function(c){return m.map.pointLocation(c)};return m};var sb=sb||{};sb.mesh={};sb.mesh.base=function(e,x,k,h){var g=d3.dispatch("added","refreshed","locationsSet","removed","draggedMap","draggedPoint","clickedMap","clickedPoint","styled","interactiveToggled"),m=parseInt(Math.random()*10000000000,10);g.dirty=true;var s=[],d=[],f=[],t={};var r=[],q=[],l=[],y=0,j=null,c=false,w=null,i=null,u=null,a=null;var p=$("#content"),b=$("#cases");d3.select(".frame").on("mousemove",v).on("mousedown",n);d3.select("body").on("mouseup",o);function n(){if(!p.hasClass("edit")){return}w=true}function v(){if(!p.hasClass("edit")){return}if(!g.dragging&&!w){return}var z=d3.svg.mouse(e);if(g.dragging){var A=x.p2l({x:z[0],y:z[1]});g.draggedPoint(g.dragging,A)}if(c&&w){i=true;if(u){x.map.panBy({x:z[0]-u[0],y:z[1]-u[1]})}g.dirty=true;g.draggedMap()}c=true;u=z}function o(){w=null;u=null;if(!p.hasClass("edit")){return}if(d3.event.target.tagName!="circle"&&g.hittest(d3.event.target)&&d3.event.target.tagName!="image"){return}if(!g.dragging&&!i){var z=d3.svg.mouse(e);var A=x.p2l({x:z[0],y:z[1]});g.clickedMap(A);i=null;return}if(!c&&g.dragging){g.clickedPoint(g.dragging)}else{v()}if(d3.event){d3.event.preventDefault();d3.event.stopPropagation()}c=false;g.dragging=null;i=null}g.editText=function(C,A,B){var z=C.find("."+B+"-edit").text("save");var E=C.find("."+B+"-text");var D=((B=="title")?E.text():f[A]);C.addClass("active");E.html('<input value="'+D+'">').find("input").focus()};g.saveText=function(C,A,B){var z=C.find("."+B+"-edit").text("edit");var D=C.find("input").val();C.removeClass("active");C.find("."+B+"-text").text(D);if(B=="place"){f[A]=D}else{return D}};g.removeInput=function(z){var A=list.selectAll("li.place .title");A.each(function(C,B){if(!C.edit){return}C.edit=false;g.saveText($(this),B,"place")});return false};g.add=function(E,A,C,z){var B=parseFloat(E);var D=parseFloat(A);s.push(B);d.push(D);if(C==undefined){f.push(E.toFixed(3)+", "+A.toFixed(3))}else{f.push(C)}r.push([D,B]);update();g.added();return g};g.remove=function(z){r.splice(z,1);s.splice(z,1);d.splice(z,1);f.splice(z,1);g.removed()};g.interactive=function(z){g.interactiveToggled(z)};g.lats=function(){return s};g.lons=function(){return d};g.places=function(){return f};g.points=function(z){if(!arguments.length){return r}r=z;return g};g.locations=function(z){q=null;r=[];s=[];d=[];f=[];$.each(z,function(A,B){r.push([B.longitude,B.latitude]);s.push(B.latitude);d.push(B.longitude);f.push(B.name)});g.locationsSet();return g};g.refresh=function(){update();g.refreshed()};g.prerender=function(){};g.applyStyle=function(z){var C=z.split("|");var B={};for(var A=0;A<C.length;A++){var D=C[A].split(":");B[D[0]]=D[1]}g.style(B)};g.style=function(A){if(!arguments.length){return t}for(var z in A){t[z]=A[z]}g.styled(t)};g.outputStyle=function(){var A=[];for(var z in t){A.push(z+":"+t[z])}return A.join("|")};g.updateTitle=function(z){a=z};g.outputTitle=function(){return a||"My Meshu"};g.output=function(){return $("#"+m).html()};g.outputMesh=function(){return".delaunay"};return g};var sb=sb||{};sb.mesh.facet=function(i,A,p,m){var l=sb.mesh.base(i,A,p,m),r=parseInt(Math.random()*10000000000,10);l.name="facet";var w=[],h=[],j=[];var e=document.createElement("div");var d=d3.select(i||"body").append("div").attr("id",r).style("width",p).style("height",m).style("position","absolute").style("z-index","1").append("svg:svg").attr("class","meshu-svg").attr("width","100%").attr("height","100%");var x=d.append("svg:g").attr("class","delaunay").attr("transform","translate(0,0) scale(1) rotate(0,300,300)").attr("fill","none").attr("stroke-width","5").attr("stroke","black").attr("stroke-linejoin","round");var v=d.append("svg:g").attr("class","hidden");v.append("svg:path");var b=d3.select(i||"body").append("div").attr("style","position:absolute;z-index:2;").style("width",p).style("height",m);var o=b.append("svg:svg").attr("width","100%").attr("height","100%");var n=o.append("svg:g").attr("id","delaunay-ui");var k=d3.select("#places");var z=k.select("#place-title").attr("class","inactive");z.append("span").attr("class","title-text");z.append("span").attr("class","title-edit").html("edit");var y=k.append("ul");if(!$("body").hasClass("firefox")){$(".place-text input").live("blur",l.removeInput)}var u=[],t=[],q=[],C=0,a=null;var s=$("#content");l.hittest=function(g){return d3.event.target!=o.node()};l.on("draggedMap",function(){f()});l.on("draggedPoint",function(D,E){D[0]=E.lon;D[1]=E.lat;var g=u.indexOf(D);w[g]=E.lat;h[g]=E.lon;l.dirty=true;f()});l.on("clickedMap",function(g){l.add(g.lat,g.lon,undefined,false)});l.on("clickedPoint",function(D){var g=u.indexOf(D);l.remove(g);A.updateBounds(w,h);l.updatePixelBounds();l.dirty=false;f()});l.on("removed",function(){if(u.length<3){$("#finish-button").removeClass("active")}if(u.length==1){$("#meshu-container").addClass("inactive")}});l.on("interactiveToggled",function(g){l.updateCircleBehavior(g)});function c(D){var H=n.selectAll("circle");H.attr("cx",function(I){return A.l2p({lat:I[1],lon:I[0]}).x}).attr("cy",function(I){return A.l2p({lat:I[1],lon:I[0]}).y});var g=x.selectAll("path").data(d3.geom.delaunay(u));g.enter().append("svg:path");g.exit().remove();g.attr("d",function(N){var J=N.length;var I=[];for(var K=0;K<J;K++){var M={lat:parseFloat(N[K][1]),lon:parseFloat(N[K][0])};var L=A.l2p(M);I.push([L.x,L.y])}return"M"+I.join("L")+"Z"});if(t&&D==true){clearInterval(C);t=null}else{if(t){var G=u[u.length-1]||[];if(Math.abs(G[0]-t[0])>0.0002){G[0]+=(t[0]-G[0])/3}if(Math.abs(G[1]-t[1])>0.0002){G[1]+=(t[1]-G[1])/3}u[u.length-1]=G;var F=Math.abs(G[0]-t[0]);var E=Math.abs(G[1]-t[1]);if(E<0.0002&&F<0.0002){clearInterval(C);t=null}}else{clearInterval(C)}}}l.updatePixelBounds=function(){if(w.length&&h.length){q=[A.l2p({lat:d3.min(w),lon:d3.min(h)}),A.l2p({lat:d3.max(w),lon:d3.min(h)}),A.l2p({lat:d3.max(w),lon:d3.max(h)}),A.l2p({lat:d3.min(w),lon:d3.max(h)})]}else{q=[]}};function f(){var H=n.selectAll("circle").data(u);H.enter().append("svg:circle").attr("id",function(J,I){return"c-"+I}).attr("r",7).on("mousedown",function(I){l.dragging=I;d3.event.stopPropagation()});H.exit().remove();var F=y.selectAll("li.place").data(u);var D=F.enter().append("li").attr("class","place");var G=D.append("span").attr("class","title");G.append("span").attr("class","place-text").html(function(J,I){e.innerHTML=j[I];return e.firstChild.nodeValue});G.append("span").attr("class","place-edit").html("edit");D.append("span").attr("class","place-delete").html("x");F.exit().remove();F.attr("id",function(J,I){return"p-"+I}).select(".title").each(function(I){I.edit=false}).attr("class","title").select(".place-text").html(function(J,I){e.innerHTML=j[I];return e.firstChild.nodeValue});z.data(u).each(function(I){I.edit=false});var g=v.selectAll("circle.rotation").data(q);g.enter().append("svg:circle").attr("class","rotation").attr("r","40").attr("cx",function(J,I){return J.x}).attr("cy",function(J,I){return J.y});g.exit().remove();g.attr("cx",function(J,I){return J.x}).attr("cy",function(J,I){return J.y});var E=v.select("path");E.attr("d",function(){if(q.length==0){return}var I=[];$.each(q,function(J,K){I.push([K.x,K.y])});return"M"+I.join("L")+"Z"}).attr("class","hiddenFrame");l.updateCircleBehavior();B();c()}l.updateCircleBehavior=function(F){var D=s.hasClass("edit");var g=$("#place-hover");var E=n.selectAll("circle");E.on("mouseover",function(M,I){if(F){return}else{if(D){y.select("#p-"+I).attr("class","place highlight")}else{g.addClass("active").find("span").text(j[I]);var L=A.l2p({lat:M[1],lon:M[0]});var G=g.width();var K=(L.y-32)+"px";var J=(L.x-(G/2)-3)+"px";var H=G/2-3+"px";g.css({top:K,left:J}).find("b").css("left",H)}}});E.on("mouseout",function(H,G){if(F){return}else{if(D){y.select("#p-"+G).attr("class","place")}else{g.removeClass("active")}}})};function B(){var g=y.selectAll("li.place");g.select(".place-delete").on("click",function(E,D){l.remove(D);l.updatePixelBounds();A.updateBounds(w,h);f()});g.on("mouseover",function(E,D){n.select("#c-"+D).attr("class","highlight")});g.on("mouseout",function(E,D){n.select("#c-"+D).attr("class","")});g.select(".place-edit").on("click",function(F,D){var E=$(this).parent();if(!F.edit){l.editText(E,D,"place")}else{l.saveText(E,D,"place")}F.edit=!F.edit});g.select(".place-text").on("click",function(E,D){if(E.edit){return}l.editText($(this).parent(),D,"place");E.edit=!E.edit});z.attr("class","").select(".title-text").text(function(D){if(D&&D.title){return D.title}else{return"My Meshu"}});z.select(".title-text").on("click",function(D){if(D.edit){return}l.editText($(this).parent(),0,"title");D.edit=!D.edit});z.select(".title-edit").on("click",function(E){var D=$(this).parent();if(!E.edit){l.editText(D,0,"title")}else{E.title=a=l.saveText(D,0,"title")}E.edit=!E.edit})}l.add=function(I,E,G,g){if(C){clearInterval(C)}var F=parseFloat(I);var H=parseFloat(E);w.push(F);h.push(H);if(G==undefined){j.push(I.toFixed(3)+", "+E.toFixed(3))}else{j.push(G)}if(u.length){$("#meshu-container").removeClass("inactive");t=[H,F];if(g){u.push([t[0],t[1]]);l.updatePixelBounds();f();c(g)}else{var D=u[u.length-1];u.push([D[0],D[1]]);l.updatePixelBounds();f();C=setInterval(c,40)}}else{u.push([H,F]);f()}l.dirty=true;l.added();return l};l.remove=function(g){u.splice(g,1);w.splice(g,1);h.splice(g,1);j.splice(g,1);if(u.length<3){$("#finish-button").removeClass("active")}if(u.length==1){$("#meshu-container").addClass("inactive")}};l.lats=function(){return w};l.lons=function(){return h};l.places=function(){return j};l.points=function(g){if(!arguments.length){return u}u=g;return l};l.bakeStyles=function(){v.style("display","none")};l.unBakeStyles=function(){v.style("display","")};l.locations=function(g){t=null;u=[];w=[];h=[];j=[];$.each(g,function(D,E){u.push([E.longitude,E.latitude]);w.push(E.latitude);h.push(E.longitude);j.push(E.name)});l.locationsSet();return l};l.refresh=function(){f();l.refreshed()};l.updateTitle=function(g){a=g};l.outputTitle=function(){return a||"My Meshu"};l.output=function(){return $("#"+r).html()};return l};var sb=sb||{};sb.materializer=function(){var c=d3.dispatch("update"),a,f,g,e,d,b;f={earrings:"pair of earrings",pendant:"small pendant necklace",necklace:"large necklace",cufflinks:"pair of cufflinks"};g={earrings:"earrings",pendant:"pendant necklace",necklace:"large necklace",cufflinks:"cufflinks"};c.initialize=function(h){a=h;c.materials=$("#material-list li");c.colors=$("#color-list li");c.materials.click(function(i){c.material(i.target.id)});c.colors.click(function(i){c.color(i.target.innerHTML)});$(".option-list li").live("click",function(){var i=$(this);i.parent().find("li").removeClass("selected");i.addClass("selected")})};c.product=function(m){if(!arguments.length){return e}e=m;var h=a.getMaterials(m);c.materials.hide();d=null;for(var j=0;j<h.length;j++){var l=h[j];if(!d){c.material(l)}$("#"+l).show()}var k=f[e];var n=k.charAt(0).toUpperCase()+k.slice(1);$("#readymade-type").text(n);return c};c.material=function(h){if(!arguments.length){return d}d=h;c.materials.removeClass("selected");$("#"+d).addClass("selected");var i=a.getColors(e,d);if(i){c.colors.find(".color-title").empty();c.colors.find("img").attr("src","");$(".options.right").fadeIn();$.each(i,function(l,m){var k=c.colors.eq(l);var j=static_url+"images/materials/"+d+"_"+m.replace(" ","_").toLowerCase()+".png";k.find(".color-title").text(m);k.find(".color-img img").attr("src",j);k.attr("id","color-"+m.replace(" ","-").toLowerCase())});c.color(i[0])}else{$(".options.right").fadeOut();c.color("")}orderer.updateProduct(e,d);$("#total-cost").text(orderer.getPriceString());return c};c.color=function(h){if(!arguments.length){return b}b=h;c.colors.removeClass("selected");$("#color-"+b.replace(" ","-").toLowerCase()).addClass("selected");c.update();return c};c.productName=function(){return g[e]};c.displayName=function(){return f[e].toLowerCase()};return c}();var sb=sb||{};sb.facebook={};$(".facebook-auth").click(function(){var a="/facebook/login";window.location=a});sb.facebook.initialize=function(h){$("#finish-button").click(function(){window.location="/make/#skipintro"});var c="Alabama,AL,Alaska,AK,Arizona,AZ,Arkansas,AR,California,CA,Colorado,CO,Connecticut,CT,Delaware,DE,Florida,FL,Georgia,GA,Hawaii,HI,Idaho,ID,Illinois,IL,Indiana,IN,Iowa,IA,Kansas,KS,Kentucky,KY,Louisiana,LA,Maine,ME,Maryland,MD,Massachusetts,MA,Michigan,MI,Minnesota,MN,Mississippi,MS,Missouri,MO,Montana,MT,Nebraska,NE,Nevada,NV,New Hampshire,NH,New Jersey,NJ,New Mexico,NM,New York,NY,North Carolina,NC,North Dakota,ND,Ohio,OH,Oklahoma,OK,Oregon,OR,Pennsylvania,PA,Rhode Island,RI,South Carolina,SC,South Dakota,SD,Tennessee,TN,Texas,TX,Utah,UT,Vermont,VT,Virginia,VA,Washington,WA,West Virginia,WV,Wisconsin,WI,Wyoming,WY";var u=c.split(",");var o={};for(var q=1;q<u.length;q+=2){o[u[q]]=u[q-1]}var d=function(i,v){return function(){$("#svg-file").val(i.outputSVG());$("#meshu-data").val(i.outputLocationData());$("#meshu-title").val(v);$("#meshu-select-form").submit()}};var s=[];var l={all:{name:"All Cities",locations:[]}};var j=[];var r=[];var m=[];var t=0;var g=function(v,w){if(w.locations.length<3){return}t+=300;setTimeout(function(){return function(){var y=$("<div>").addClass("mini-meshu");var x=$("<div>").addClass("title").html(w.name);y.append(x).fadeIn();$("#maps").append(y);var i=sb.minimeshu(y[0]);setTimeout(function(){i.locations(w.locations)},100);y.click(d(i,w.name))}}(),t)};var e=function(i,v){if(!l[v]){l[v]={name:v,locations:[],seen:{}};i.push(l[v])}};var b=function(v,w,i,x){if(!l[w].seen[x]){l[w].locations.push(i);l[w].seen[x]=i}else{l[w].seen[x].times++}};var f=function(){var i=function(w,v){return v.locations.length-w.locations.length};j.sort(i);r.sort(i);m.sort(i);if(m.length>1){m.unshift(l.all);$.each(m,g)}else{g(0,l.all)}if(r.length>1){$.each(r,g)}if(j.length){$.each(j,g)}else{$(".page-header").html("Oh no! Not enough checkins to make any meshus.");$("#finish-button").html("Make one manually")}};var p=0;var n=function(i){var v=i.data;if(!v||!v.length){f();return}p+=i.data.length;$.each(v,function(y,A){if(!A.place||!A.place.location||!A.place.location.city){return}var C=A.place.location.city;var B=A.place.location.country;var w={latitude:A.place.location.latitude,longitude:A.place.location.longitude,name:A.place.name,times:1};var x={name:C,latitude:w.latitude,longitude:w.longitude};if(!l[C]){l.all.locations.push(x)}e(j,C);e(m,B);b(j,C,w,w.name);b(m,B,x,C);var z=A.place.location.state;if(z&&B=="United States"){if(o[z.toUpperCase()]){z=o[z.toUpperCase()]}e(r,z);b(r,z,x,x.name)}});$.ajax({url:i.paging.next,dataType:"jsonp",success:function(w){if(w.data&&w.data.length){$(".page-header").html("Loaded "+p+" places...");n(w)}else{$(".page-header").html("Each meshu is a different set of places. Choose one to get started!");f()}},error:function(w){console.warn(w)}})};var k=false;function a(){h.api("/me/locations?limit=50",function(i){if(i.error){if(k){$(".page-header").html("We're not sure what happened! Try connecting to Facebook again?")}else{$(".page-header").html("Oops, there was an error connecting to Facebook. Retrying...");setTimeout(a,500);k=true}}else{n(i)}})}a()};$(".foursquare-auth").click(function(){var a="AJXTWLOH1K5RIWG33XSGQZHRISL5CCJ0XG1VUL3NAKDYYPMM";var d="https://meshu.io/make/foursquare/";var c="https://foursquare.com/oauth2/authenticate?client_id={client}&response_type=token&redirect_uri={redirect}";var b=c.replace("{client}",a).replace("{redirect}",d);window.location=b});var sb=sb||{};sb.foursquare={};sb.foursquare.initialize=function(){var a=window.location.hash,h=a.split("=").pop(),m="https://api.foursquare.com/v2/users/self/checkins?oauth_token={token}&v={v}&limit=250&offset={offset}",s=m.replace("{token}",h).replace("{v}","20120102");window.location.hash="#connected";$("#finish-button").click(function(){window.location="/make/#skipintro"});if(!h||!h.length){return}var c="Alabama,AL,Alaska,AK,Arizona,AZ,Arkansas,AR,California,CA,Colorado,CO,Connecticut,CT,Delaware,DE,Florida,FL,Georgia,GA,Hawaii,HI,Idaho,ID,Illinois,IL,Indiana,IN,Iowa,IA,Kansas,KS,Kentucky,KY,Louisiana,LA,Maine,ME,Maryland,MD,Massachusetts,MA,Michigan,MI,Minnesota,MN,Mississippi,MS,Missouri,MO,Montana,MT,Nebraska,NE,Nevada,NV,New Hampshire,NH,New Jersey,NJ,New Mexico,NM,New York,NY,North Carolina,NC,North Dakota,ND,Ohio,OH,Oklahoma,OK,Oregon,OR,Pennsylvania,PA,Rhode Island,RI,South Carolina,SC,South Dakota,SD,Tennessee,TN,Texas,TX,Utah,UT,Vermont,VT,Virginia,VA,Washington,WA,West Virginia,WV,Wisconsin,WI,Wyoming,WY";var v=c.split(",");var o={};for(var q=1;q<v.length;q+=2){o[v[q]]=v[q-1]}var d=function(i,w){return function(){$("#svg-file").val(i.outputSVG());$("#meshu-data").val(i.outputLocationData());$("#meshu-title").val(w);$("#meshu-select-form").submit()}};var t=[];var l={all:{name:"All Cities",locations:[]}};var k=[];var r=[];var n=[];var u=0;var j=function(w,x){if(x.locations.length<3){return}u+=300;setTimeout(function(){return function(){var z=$("<div>").addClass("mini-meshu");var y=$("<div>").addClass("title").html(x.name);z.append(y).fadeIn();$("#maps").append(z);var i=sb.minimeshu(z[0]);setTimeout(function(){i.locations(x.locations)},100);z.click(d(i,x.name))}}(),u)};var e=function(i,w){if(!l[w]){l[w]={name:w,locations:[],seen:{}};i.push(l[w])}};var b=function(w,x,i,y){if(!l[x].seen[y]){l[x].locations.push(i);l[x].seen[y]=i}else{l[x].seen[y].times++}};var g=function(){var i=function(x,w){return w.locations.length-x.locations.length};k.sort(i);r.sort(i);n.sort(i);if(n.length>1){n.unshift(l.all);$.each(n,j)}else{j(0,l.all)}if(r.length>1){$.each(r,j)}if(k.length){$.each(k,j)}else{$(".page-header").html("Oh no! Not enough checkins to make any meshus.");$("#finish-button").html("Make one manually")}};var p=0;var f=function(i){$.ajax({url:i,dataType:"jsonp",success:function(y){if(!y.response.checkins){g();return}var w=y.response.checkins.items;if(!w||!w.length){g();return}p+=y.response.checkins.items.length;$.each(w,function(B,D){if(!D.venue||!D.venue.location||!D.venue.location.city){return}var F=D.venue.location.city;var E=D.venue.location.country;var z={latitude:D.venue.location.lat,longitude:D.venue.location.lng,name:D.venue.name,times:1};var A={name:F,latitude:z.latitude,longitude:z.longitude};if(!l[F]){l.all.locations.push(A)}e(k,F);e(n,E);b(k,F,z,z.name);b(n,E,A,F);var C=D.venue.location.state;if(C&&E=="United States"){if(o[C.toUpperCase()]){C=o[C.toUpperCase()]}e(r,C);b(r,C,A,A.name)}});var x=y.response.checkins.count;if(p<x){$(".page-header").html("Loaded "+p+" of "+x+" checkins...");f(s.replace("{offset}",p))}else{$(".page-header").html("Each meshu is a different set of places. Choose one to get started!");g()}}})};f(s.replace("{offset}",p))};$(function(){var k=$("html").hasClass("svg");var a=loadedMeshu?loadedMeshu.promo:null,f=loadedMeshu&&loadedMeshu.product!="",j=window.location.href.search("postcard")>0?-0.25:0,e=loadedMeshu?loadedMeshu.renderer:$("body").hasClass("radial")?"radial":null;var g=sb.catalog(e,a);orderer.catalog(g);sb.materializer.initialize(g);meshu=sb.meshu($("#meshu-container")[0],e);meshu.zoomOffset=j;meshu.isReadymade=f;var c=sb.ui.orderer(meshu);c.on("validated",function(){sb.viewhandler.view("review");d("review");return false});sb.ui.socialsharer(meshu);sb.viewhandler.initialize();if(loadedMeshu){saver.initialize(meshu);saver.updateMeshuData(loadedMeshu);user.updateLogoutActions(pageType);sb.viewhandler.updateViews(pageType);switch(pageType){case"view":if(k){meshu.map().buffer(0)}break;case"product":var i=$("#product");i.find(".nav").remove();i.find(".make-wrapper").removeClass("make-wrapper");break;default:$("#materials").addClass("ready");var i=loadedMeshu.product.length?loadedMeshu.product:"necklace";sb.materializer.product(i);break}if(k){if(meshu.isReadymade&&readymade){readymade.initialize(meshu)}meshu.initializeFromData(loadedMeshu.location_data,loadedMeshu.metadata,loadedMeshu.svg)}h();$("#finish-button").addClass("active");$("#meshu-container").removeClass("inactive");var l=loadedMeshu.location_data.split("|");$.each(l,function(n,p){var o=p.split("\t");if(o.length==3){var q=document.createElement("div");q.innerHTML=o[2];var m=q.firstChild.nodeValue;$("<li>").html(m).appendTo($("#display-places"))}});d3.select("#places").attr("class","").select("#place-title").attr("class","").select(".title-text").html(function(m){m.title=loadedMeshu.title;meshu.updateTitle(m.title);return m.title})}else{saver.initializeNewMeshu(meshu)}sb.viewhandler.updateAccountView();sb.viewhandler.on("next",d);sb.viewhandler.on("prev",b);if(!user.loggedIn&&!loadedMeshu&&window.location.hash!="#skipintro"){$(".tooltip").each(function(m,n){setTimeout(function(){$(n).fadeIn()},m*1000)});$(document).click(function(){$(".tooltip").fadeOut()})}$("#product-preview svg").live("click",function(){var m=$(this).attr("id").split("-")[1];$(".make-option").hide();$("#make-"+m).show();sb.rotator.update(m);sb.materializer.product(m);sb.rotator.on("rotated",sb.product.rotation)});function h(){if(meshu.mesh().name=="facet"){sb.product.initialize(".delaunay",g);sb.rasterizer.rasterize(meshu)}else{if(meshu.mesh().name=="radial"){sb.rasterizer.thumbnail(meshu,function(m){sb.product.initialize(m,g);sb.rasterizer.rasterize(meshu)})}}}function d(){var m=sb.viewhandler.view();switch(m){case"edit":meshu.updateBounds();meshu.mesh().interactive(true);h();break;case"make":case"readymade":meshu.mesh().interactive(false);var p=sb.materializer.product();var o=sb.transforms[p]["render"];meshu.animateTransform(sb.rotator?sb.rotator.rotation():0,o.scale,o.transform.x,o.transform.y);d3.select(".delaunay").attr("class","delaunay "+p);var q=static_url+"images/render/"+p+"_preview.jpg",n="url("+q+")";$(".render").css("background-image",n);break;case"review":c.updated();break}}function b(){var m=sb.viewhandler.view();switch(m){case"edit":meshu.mesh().interactive(true);break;case"make":case"readymade":meshu.mesh().interactive(true);meshu.animateTransform(0,1,0,0);break}}$(".show-places").click(function(){$("#display-places").slideToggle();$(".show-places").toggle()})});