// stripe.js
Stripe.setPublishableKey("pk_GtEuTncR1hDqm7tP3oz9RRM9XOLub");var orderer=function(){var h={},f=0,c=0,e=null,d=null,g=null,b=4,i=null;function a(j,k){if(k.error){$("#submit-button").removeAttr("disabled").removeClass("inactive");$(".payment-errors").html(k.error.message)}else{var m=$("#payment-form");var l=k.id;m.append("<input type='hidden' name='stripeToken' value='"+l+"' />");m.get(0).submit()}}h.submit=function(){if(f<2000){return}$("#submit-button").attr("disabled","disabled").addClass("inactive");$(".card-info").removeAttr("name");Stripe.createToken({number:$("#card-number").val(),cvc:$("#card-cvc").val(),exp_month:$("#card-expiry-month").val(),exp_year:$("#card-expiry-year").val()},f,a);return false};h.applyCoupon=function(j,k){$.get("/order/apply_coupon",{code:j},function(l){if(l.success){c=parseInt(l.amount)}if(k){k(l)}},"json")};h.options=function(j){if(i){return}i=j;return h};h.updateProduct=function(k,j,l){if(!i[k]||!i[k][j]){return}b=l||4;e=k;d=j;f=(i[e][d].price+b-c)*100;return h};h.getPrice=function(){if(!i){return null}return i[e][d].price};h.getPriceString=function(){if(!i){return null}return"$"+i[e][d].price+".00"};h.getTotal=function(){if(!i){return null}return i[e][d].price+b-c};h.getTotalCents=function(){if(!i){return null}return(i[e][d].price+b-c)*100};h.getTotalString=function(){if(!i){return null}return"$"+(i[e][d].price+b-c)+".00"};h.getColors=function(k,j){if(!i){return null}return i[k][j].colors};return h}();

// map.js
var sb=sb||{};sb.map=function(d,c,h){var e=org.polymaps;var i={};var b="http://{S}tile.stamen.com/toner/{Z}/{X}/{Y}.png";var a=d3.select(d||"body").append("div")[0][0];a.style.position="absolute";a.style.width=c;a.style.height=h;var f=e.image().url(e.url(b).hosts(["a.","b.","c.","d.",""]));i.dispatch=d3.dispatch("show");i.map=e.map().container(a.appendChild(e.svg("svg"))).zoom(12).center({lat:37.755,lon:-122.445});i.map.add(f);var g=d3.select(".map");g.attr("width","100%").attr("height","100%");g.select("rect").attr("visibility","visible").attr("fill","white");i.frame=function(){return a};i.show=function(){if(!f.map()){i.map.add(f)}};i.hide=function(){if(f.map()){i.map.remove(f)}};i.updateBounds=function(l,k){if(l.length==0||k.length==0){return}if(l.length==1&&k.length==1){i.map.center({lat:l[0],lon:k[0]}).zoom(10);return}var j=[{lat:d3.min(l),lon:d3.min(k)},{lat:d3.max(l),lon:d3.max(k)}];i.map.extent(j);i.map.zoom(i.map.zoom()-0.5)};i.resizeContainer=function(k,n){var s=[{lat:d3.min(k),lon:d3.min(n)},{lat:d3.max(k),lon:d3.max(n)}];i.map.zoom(10).center({lat:0,lon:0});var l=i.map.locationPoint(s[0]);var o=i.map.locationPoint(s[1]);var j=Math.abs(o.x-l.x);var r=Math.abs(o.y-l.y);var p=430;var m=j>r?p/j:p/r;j*=m;r*=m;a.style.width=(j)+"px";a.style.height=(r)+"px";i.map.extent(s);var q=i.l2p(s[0]).y-i.l2p(i.map.extent()[0]).y;if(q){a.style.top=(150-q)+"px"}};i.getBounds=function(){var k=i.map.extent();var j=i.map.locationPoint(k[0]);var l=i.map.locationPoint(k[1]);return{t:l.y,b:j.y,l:j.x,r:l.x}};i.l2p=function(j){return i.map.locationPoint(j)};i.p2l=function(j){return i.map.pointLocation(j)};return i};

// mesh.js
var sb=sb||{};sb.mesh=function(b,z,a,d){var m=d3.dispatch("added"),t=parseInt(Math.random()*10000000000,10);var c=[],u=[],w=[];var j=document.createElement("div");var h=d3.select(b||"body").append("div").attr("id",t).style("width",a).style("height",d).style("position","absolute").style("z-index","100").append("svg:svg").attr("class","meshu-svg").attr("width","100%").attr("height","100%");var M=h.append("svg:g").attr("class","delaunay").attr("transform","translate(0,0) scale(1) rotate(0,300,300)");var r=h.append("svg:g").attr("class","hidden");r.append("svg:path");var q=d3.select(b||"body").append("div").attr("style","position:absolute;z-index:1337;").style("width",a).style("height",d);var f=q.append("svg:svg").attr("width","100%").attr("height","100%");var I=f.append("svg:g").attr("id","delaunay-ui");var l=d3.select("#places");var C=l.select("#place-number").attr("class","inactive");C.append("span").attr("class","title-text");C.append("span").attr("class","title-edit").html("edit");var v=l.append("ul");if(!$("body").hasClass("ie")){$(".place-text input").live("blur",i)}var J=[],n=[],y=[],K=0,A=null,e=false,k=null,H=null,O=null,F=null,E=null;var o=$("#content"),p=$("#cases");d3.select(".frame").on("mousemove",x).on("mousedown",s);d3.select("body").on("mouseup",G);function s(){if(!o.hasClass("edit")){return}H=true}function x(){if(!o.hasClass("edit")){return}if(!k&&!H){return}var g=d3.svg.mouse(h.node());if(k){var Q=z.p2l({x:g[0],y:g[1]});k[0]=Q.lon;k[1]=Q.lat;var R=J.indexOf(k);c[R]=Q.lat;u[R]=Q.lon;D()}if(e&&H){O=true;if(F){z.map.panBy({x:g[0]-F[0],y:g[1]-F[1]})}D()}e=true;F=g}function G(){H=null;F=null;if(!o.hasClass("edit")){return}if(d3.event.target.tagName!="circle"&&d3.event.target!=f.node()&&d3.event.target.tagName!="image"){return}if(!k&&!O){var g=d3.svg.mouse(h.node());var R=z.p2l({x:g[0],y:g[1]});m.add(R.lat,R.lon,undefined,false);m.added();O=null;return}if(!e&&k){var Q=J.indexOf(k);m.remove(Q);z.updateBounds(c,u);m.updatePixelBounds();D()}else{x()}if(d3.event){d3.event.preventDefault();d3.event.stopPropagation()}e=false;k=null;O=null}m.updatePixelBounds=function(){if(c.length&&u.length){y=[z.l2p({lat:d3.min(c),lon:d3.min(u)}),z.l2p({lat:d3.max(c),lon:d3.min(u)}),z.l2p({lat:d3.max(c),lon:d3.max(u)}),z.l2p({lat:d3.min(c),lon:d3.max(u)})]}else{y=[]}};function B(Q){var U=I.selectAll("circle");U.attr("cx",function(V){return z.l2p({lat:V[1],lon:V[0]}).x}).attr("cy",function(V){return z.l2p({lat:V[1],lon:V[0]}).y});var g=M.selectAll("path").data(d3.geom.delaunay(J));g.enter().append("svg:path");g.exit().remove();g.attr("d",function(aa){var W=aa.length;var V=[];for(var X=0;X<W;X++){var Z={lat:parseFloat(aa[X][1]),lon:parseFloat(aa[X][0])};var Y=z.l2p(Z);V.push([Y.x,Y.y])}return"M"+V.join("L")+"Z"});if(n&&Q==true){clearInterval(K);n=null}else{if(n){var T=J[J.length-1]||[];if(Math.abs(T[0]-n[0])>0.0002){T[0]+=(n[0]-T[0])/3}if(Math.abs(T[1]-n[1])>0.0002){T[1]+=(n[1]-T[1])/3}J[J.length-1]=T;var S=Math.abs(T[0]-n[0]);var R=Math.abs(T[1]-n[1]);if(R<0.0002&&S<0.0002){clearInterval(K);n=null}}else{clearInterval(K)}}}function D(){var U=I.selectAll("circle").data(J);U.enter().append("svg:circle").attr("id",function(W,V){return"c-"+V}).attr("r",7).on("mousedown",function(V){A=k=V;d3.event.stopPropagation()});U.exit().remove();var S=v.selectAll("li.place").data(J);var Q=S.enter().append("li").attr("class","place");var T=Q.append("span").attr("class","title");T.append("span").attr("class","place-text").html(function(W,V){j.innerHTML=w[V];return j.firstChild.nodeValue});T.append("span").attr("class","place-edit").html("edit");Q.append("span").attr("class","place-delete").html("x");S.exit().remove();S.attr("id",function(W,V){return"p-"+V}).select(".title").each(function(V){V.edit=false}).select(".place-text").html(function(W,V){j.innerHTML=w[V];return j.firstChild.nodeValue});C.data(J).each(function(V){V.edit=false});var g=r.selectAll("circle.rotation").data(y);g.enter().append("svg:circle").attr("class","rotation").attr("r","40").attr("cx",function(W,V){return W.x}).attr("cy",function(W,V){return W.y});g.exit().remove();g.attr("cx",function(W,V){return W.x}).attr("cy",function(W,V){return W.y});var R=r.select("path");R.attr("d",function(){if(y.length==0){return}var V=[];$.each(y,function(W,X){V.push([X.x,X.y])});return"M"+V.join("L")+"Z"}).attr("class","hiddenFrame");m.updateCircleBehavior();L();B()}m.updateCircleBehavior=function(S){var Q=o.hasClass("edit");var g=$("#place-hover");var R=I.selectAll("circle");R.on("mouseover",function(Z,V){if(S){return}else{if(Q){v.select("#p-"+V).attr("class","place highlight")}else{g.addClass("active").find("span").text(w[V]);var Y=z.l2p({lat:Z[1],lon:Z[0]});var T=g.width();var X=(Y.y-32)+"px";var W=(Y.x-(T/2)-3)+"px";var U=T/2-3+"px";g.css({top:X,left:W}).find("b").css("left",U)}}});R.on("mouseout",function(U,T){if(S){return}else{if(Q){v.select("#p-"+T).attr("class","place")}else{g.removeClass("active")}}})};function L(){var g=v.selectAll("li.place");g.select(".place-delete").on("click",function(R,Q){m.remove(Q);m.updatePixelBounds();z.updateBounds(c,u);D()});g.on("mouseover",function(R,Q){I.select("#c-"+Q).attr("class","highlight")});g.on("mouseout",function(R,Q){I.select("#c-"+Q).attr("class","")});g.select(".place-edit").on("click",function(S,Q){var R=$(this).parent();if(!S.edit){P(R,Q,"place")}else{N(R,Q,"place")}S.edit=!S.edit});g.select(".place-text").on("click",function(R,Q){if(R.edit){return}P($(this).parent(),Q,"place");R.edit=!R.edit});C.attr("class","").select(".title-text").text(function(Q){if(Q&&Q.title){return Q.title}else{return"My Meshu"}});C.select(".title-text").on("click",function(Q){if(Q.edit){return}P($(this).parent(),0,"title");Q.edit=!Q.edit});C.select(".title-edit").on("click",function(R){var Q=$(this).parent();if(!R.edit){P(Q,0,"title")}else{R.title=E=N(Q,0,"title")}R.edit=!R.edit})}function P(S,Q,R){var g=S.find("."+R+"-edit").text("save");var U=S.find("."+R+"-text");var T=((R=="title")?U.text():w[Q]);S.addClass("active");U.html('<input value="'+T+'">').find("input").focus()}function N(S,Q,R){var g=S.find("."+R+"-edit").text("edit");var T=S.find("input").val();S.removeClass("active");S.find("."+R+"-text").text(T);if(R=="place"){w[Q]=T}else{return T}}function i(g){var Q=v.selectAll("li.place .title");Q.each(function(S,R){if(!S.edit){return}S.edit=false;N($(this),R,"place")})}m.add=function(V,R,T,g){if(K){clearInterval(K)}var S=parseFloat(V);var U=parseFloat(R);c.push(S);u.push(U);if(T==undefined){w.push(V.toFixed(3)+", "+R.toFixed(3))}else{w.push(T)}if(J.length){$("#meshu-container").removeClass("inactive");n=[U,S];if(g){J.push([n[0],n[1]]);m.updatePixelBounds();D();B(g)}else{var Q=J[J.length-1];J.push([Q[0],Q[1]]);m.updatePixelBounds();D();K=setInterval(B,40)}}else{J.push([U,S]);D()}p.fadeOut();return m};m.remove=function(g){J.splice(g,1);c.splice(g,1);u.splice(g,1);w.splice(g,1);if(J.length<3){$("#finish-button").removeClass("active")}if(J.length==1){$("#meshu-container").addClass("inactive")}};m.lats=function(){return c};m.lons=function(){return u};m.places=function(){return w};m.points=function(g){if(!arguments.length){return J}J=g;return m};m.locations=function(g){n=null;J=[];c=[];u=[];w=[];$.each(g,function(Q,R){J.push([R.longitude,R.latitude]);c.push(R.latitude);u.push(R.longitude);w.push(R.name)});D();return m};m.refresh=function(){D()};m.updateTitle=function(g){E=g};m.outputTitle=function(){return E||"My Meshu"};m.output=function(){return $("#"+t).html()};return m};

// meshu.js
var sb=sb||{};var app_key="dj0yJmk9M1hsekZBSDY1ZjRxJmQ9WVdrOU5uUjZiRzE0TXpRbWNHbzlNVEV5TURZMU1qRTJNZy0tJnM9Y29uc3VtZXJzZWNyZXQmeD00OQ--";sb.meshu=function(d){var l={},c=$(d).width()+"px",j=$(d).height()+"px",a=sb.map(d,c,j),m=sb.mesh(d,a,c,j),k=$("#cases");$(d).append("<div class='mapui'><div id='zoomin'></div><div id='zoomout'></div></div>");$("#zoomin").mousedown(function(n){a.map.zoom(a.map.zoom()+1);m.refresh()});$("#zoomout").mousedown(function(n){a.map.zoom(a.map.zoom()-1);m.refresh()});var i=$("#searchbox");i.focus(function(){k.fadeOut()});i.keypress(function(n){if(n.which==13){e()}});$("#search-button").click(function(){e()});m.on("added",f);function f(){var n=m.points();if(n.length>3){$("#finish-button").addClass("active")}else{$("#finish-button").removeClass("active")}}function e(){var n=i.val();if(n=="add a city, place, or address"){return}var p=n.replace("&","and").replace(/[^\w ]/ig,"").replace(" ","+");var o=$("body").hasClass("ie")?"/proxy/geocoder/?location="+p:"http://where.yahooapis.com/geocode?location="+p+"&flags=J&appid="+app_key;i.val("");$.ajax({url:o,cache:false,dataType:"json",error:function(q,s,r){console.log(r)},success:function(t){var r=t.ResultSet.Results;var s=$("#content");k.empty().hide();if(typeof r=="undefined"){i.blur();k.append($("<p>").text("Hrm, we weren't able to find your search. Try again?")).fadeIn()}else{if(r.length==1){b(r[0],n);if(m.points().length==1){var q=r[0].radius;if(q>1000000){a.map.zoom(3)}else{if(q>100000){a.map.zoom(4)}else{if(q>10000){a.map.zoom(12)}else{if(q>400){a.map.zoom(14)}}}}}}else{k.append($("<p>").text("Oops, we're not sure which place you meant. Try a more specific search?")).fadeIn();i.blur()}}}})}function b(n,o){m.add(n.latitude,n.longitude,o);l.updateBounds();f()}l.locations=function(n,p){for(var o=0;o<n.length;o++){if(p){b(n[o],n[o].name)}else{setTimeout(function(q){return function(){b(q,q.name)}}(n[o]),o*400)}}};l.locationData=function(r){var n=r.split("|");var q=[];for(var p=0;p<n.length;p++){var o=n[p].split("\t");if(o.length!=3){continue}q.push({latitude:parseFloat(o[0]),longitude:parseFloat(o[1]),name:o[2]})}m.locations(q);l.updateBounds();return l};l.mesh=function(){return m};var g=0;var h;l.animateTransform=function(p){if(h){clearInterval(h)}var n=0;var o=d3.select(".delaunay");h=setInterval(function(){if(++n<30){g+=(p-g)*0.33;var q="rotate("+g+",300,300)";o.attr("transform",q)}else{clearInterval(h)}},40)};l.updateBounds=function(){a.updateBounds(m.lats(),m.lons());m.updatePixelBounds();m.refresh()};l.updateTitle=function(n){m.updateTitle(n)};l.outputTitle=function(){return m.outputTitle()};l.outputSVG=function(){return m.output()};l.outputLocationData=function(){var n=[];var p=m.places(),q=m.lats(),o=m.lons();$.each(p,function(s){var r=q[s]+"\t"+o[s]+"\t"+p[s];n.push(r)});return n.join("|")};return l};

// product.js
var sb=sb||{};$(function(){sb.product=function(){var a={};var c=["earrings","pendant","necklace","cufflinks"];var b=["scale(.09) translate(830, 710) ","scale(.045) translate(1570, 2200)","scale(.09) translate(650, 980) ","scale(.075) translate(870, 1170)"];a.initialize=function(d){for(var e=0;e<c.length;e++){a.initializeProduct(c[e],b[e],d)}};a.initializeProduct=function(g,f,e){var d=d3.select("#preview-"+g);d.selectAll("*").remove();d.append("svg:image").attr("x",0).attr("y",0).attr("width","100%").attr("height","100%").attr("xlink:href",static_url+"images/preview/preview_"+g+".png");a.attachMeshu(e,$(d[0]),f)};a.attachMeshu=function(g,f,d){var e=$(g).clone().attr("class","product-delaunay").attr("transform",d);f.append(e)};a.thumbnail=function(g,f,d){var e=$(g).clone().attr("class","product-delaunay").attr("transform",d);d3.select(f[0]).append("svg:rect").attr("x","0").attr("y",0).attr("width","100%").attr("height","100%");f.append(e)};a.rotation=function(d){d3.selectAll(".product-delaunay").attr("transform",function(f,e){return b[e]+" rotate("+d+", 300, 300)"})};return a}()});

// preview.js
var sb=sb||{};$(function(){sb.rotator=function(e,d,b){var c=d3.dispatch("rotated");var f=0,h="scale(.125) translate(380, 670) ";var g={earrings:"scale(.125) translate(650, 540)",pendant:"scale(.075) translate(1030, 1470)",necklace:"scale(.125) translate(510, 760)",cufflinks:"scale(.125) translate(510, 760)"};c.update=function(v){$(e).empty();var n=d3.select(e);var m=n.append("svg:image").attr("id","previewImage").attr("x",0).attr("y",0).attr("width",200).attr("height",190).attr("xlink:href",c.getImage(v));var i=n.append("svg:g").attr("id","transform").attr("transform",c.getTransform(v));var l=$(d).clone().attr("id","mini-delaunay");var j=$(b).clone().attr("id","rotate-ui");$(i[0]).append(l).append(j);if(v=="pendant"){n.select("#rotate-ui").attr("class","hidden pendant").selectAll("circle").attr("r","55")}d3.selectAll("circle.rotation").on("mousedown",r);n.on("mouseup",o).on("mousemove",t);var q,p,y,x,k,s,u,w;var s=0;function r(){var z=d3.svg.mouse(n.node());q=z[0]-100,p=z[1]-100;u=true}function t(){if(!u){return}var z=d3.svg.mouse(n.node());y=z[0]-100,x=z[1]-100;w=a(q,p,y,x);var B=Math.sqrt(Math.pow(q,2)+Math.pow(p,2));var A=Math.sqrt(Math.pow(y,2)+Math.pow(x,2));k=Math.acos((q*y+p*x)/(B*A))*180/Math.PI;f=w?(f-k)%360:(f+k)%360;if(isNaN(f)){f=0}q=y,p=x;c.rotated(f);i.attr("transform",c.getTransform(v))}function o(){u=false;if(d3.event){d3.event.preventDefault();d3.event.stopPropagation()}}};c.getTransform=function(i){return g[i]+" rotate("+f+",300,300)"};c.getImage=function(i){return static_url+"images/preview/preview_"+i+".png"};c.rotation=function(i){if(!arguments.length){return f}f=i;return c};function a(j,l,i,k){if(i>j){if(l>0&&k>0){return true}else{return false}}else{if(i<j){if(l<0&&k<0){return true}else{return false}}else{if(k<l){if(j>0){return true}else{return false}}else{if(j<0){return true}else{return false}}}}}return c}("#rotate",".delaunay",".hidden")});

// materializer.js
var sb=sb||{};sb.materializer=function(){var b=d3.dispatch("update"),c,f,g,e,d,a;b.initialize=function(j,i,h){c=j;f=i;g=h;b.materials=$("#material-list li");b.colors=$("#color-list li");b.materials.click(function(k){b.material(k.target.id)});b.colors.click(function(k){b.color(k.target.innerHTML)});$(".option-list li").live("click",function(){var k=$(this);k.parent().find("li").removeClass("selected");k.addClass("selected")})};b.product=function(l){if(!arguments.length){return e}e=l;var h=c[l];b.materials.hide();d=null;for(var j in h){if(!d){b.material(j)}$("#"+j).show()}var k=f[e];var m=k.charAt(0).toUpperCase()+k.slice(1);$("#readymade-type").text(m);return b};b.material=function(h){if(!arguments.length){return d}d=h;b.materials.removeClass("selected");$("#"+d).addClass("selected");var i=c[e][d].colors;if(i){b.colors.find(".color-title").empty();b.colors.find("img").attr("src","");$(".options.right").fadeIn();$.each(i,function(l,m){var k=b.colors.eq(l);var j=static_url+"images/materials/"+d+"_"+m.toLowerCase()+".png";k.find(".color-title").text(m);k.find(".color-img img").attr("src",j);k.attr("id","color-"+m.toLowerCase())});b.color(i[0])}else{$(".options.right").fadeOut();b.color("")}orderer.updateProduct(e,d);$("#total-cost").text(orderer.getPriceString());return b};b.color=function(h){if(!arguments.length){return a}a=h;b.colors.removeClass("selected");$("#color-"+a.toLowerCase()).addClass("selected");b.update();return b};b.productName=function(){return g[e]};b.displayName=function(){return f[e].toLowerCase()};return b}();

// saver.js
var saver=function(){var a={};function d(){return{xhr:"true",title:a.meshu.outputTitle(),svg:a.meshu.outputSVG(),location_data:a.meshu.outputLocationData()}}function c(e){if(!e){return}if($("#meshu-id").length==0){$("#hidden-form-values").append('<input type="hidden" id="meshu-id" name="meshu_id" />')}$("#meshu-id").val(e)}function b(){var e=d();e.csrfmiddlewaretoken=$("#csrf input").val();if($("#meshu-id").length){e.id=parseInt($("#meshu-id").val())}$.post("/make/create/",e,function(f){c(f.meshu_id);if(a.postCreateCallback){a.postCreateCallback(f)}},"json")}a.initialize=function(f,e){a.meshu=f;$("#cancel-button").click(function(){window.location.href=e});$("#save-button").click(function(){if(!loadedMeshu){return}$("#save-button").html("saving");var g=loadedMeshu.edit_url+"save";$.get(g,d(),function(h){c(h.meshu_id);setTimeout(function(){$("#save-button").html("saved!")},200);setTimeout(function(){window.location.href=h.meshu_url},1000)},"json")});$("#update-button").click(function(){if(!loadedMeshu){return}$("#update-button").html("updating");var g=loadedMeshu.edit_url+"update";$.get(g,d(),function(h){c(h.meshu_id);setTimeout(function(){$("#update-button").html("saved!")},200);setTimeout(function(){window.location.href=h.meshu_url},1000)},"json")});return a};a.initializeNewMeshu=function(e){a.meshu=e;return a};a.createOrUpdateMeshu=function(e){if(a.meshu.isReadymade&&e){e()}else{b();if(e){a.postCreateCallback=e}}return a};a.getMeshuID=function(){return $("#meshu-id").val()};return a}();

// foursquare.js
$(".foursquare-auth").click(function(){var a="AJXTWLOH1K5RIWG33XSGQZHRISL5CCJ0XG1VUL3NAKDYYPMM";var d="http://meshu.io/make/foursquare/";var c="https://foursquare.com/oauth2/authenticate?client_id={client}&response_type=token&redirect_uri={redirect}";var b=c.replace("{client}",a).replace("{redirect}",d);window.location=b});var sb=sb||{};sb.foursquare={};sb.foursquare.initialize=function(){var a=window.location.hash,h=a.split("=").pop(),m="https://api.foursquare.com/v2/users/self/checkins?oauth_token={token}&v={v}&limit=250&offset={offset}",s=m.replace("{token}",h).replace("{v}","20120102");$("#finish-button").click(function(){window.location="/make/#skipintro"});if(!h||!h.length){return}var c="Alabama,AL,Alaska,AK,Arizona,AZ,Arkansas,AR,California,CA,Colorado,CO,Connecticut,CT,Delaware,DE,Florida,FL,Georgia,GA,Hawaii,HI,Idaho,ID,Illinois,IL,Indiana,IN,Iowa,IA,Kansas,KS,Kentucky,KY,Louisiana,LA,Maine,ME,Maryland,MD,Massachusetts,MA,Michigan,MI,Minnesota,MN,Mississippi,MS,Missouri,MO,Montana,MT,Nebraska,NE,Nevada,NV,New Hampshire,NH,New Jersey,NJ,New Mexico,NM,New York,NY,North Carolina,NC,North Dakota,ND,Ohio,OH,Oklahoma,OK,Oregon,OR,Pennsylvania,PA,Rhode Island,RI,South Carolina,SC,South Dakota,SD,Tennessee,TN,Texas,TX,Utah,UT,Vermont,VT,Virginia,VA,Washington,WA,West Virginia,WV,Wisconsin,WI,Wyoming,WY";var v=c.split(",");var o={};for(var q=1;q<v.length;q+=2){o[v[q]]=v[q-1]}var d=function(i,w){return function(){$("#svg-file").val(i.outputSVG());$("#meshu-data").val(i.outputLocationData());$("#meshu-title").val(w);$("#meshu-select-form").submit()}};var t=[];var l={all:{name:"All Cities",locations:[]}};var k=[];var r=[];var n=[];var u=0;var j=function(w,x){if(x.locations.length<3){return}u+=250;setTimeout(function(){return function(){var z=$("<div>").addClass("mini-meshu");var y=$("<div>").addClass("title").html(x.name);z.append(y).fadeIn();$("#maps").append(z);var i=sb.minimeshu(z[0]);i.locations(x.locations);z.click(d(i,x.name))}}(),u)};var e=function(i,w){if(!l[w]){l[w]={name:w,locations:[],seen:{}};i.push(l[w])}};var b=function(w,x,i,y){if(!l[x].seen[y]){l[x].locations.push(i);l[x].seen[y]=i}else{l[x].seen[y].times++}};var g=function(){var i=function(x,w){return w.locations.length-x.locations.length};k.sort(i);r.sort(i);n.sort(i);if(n.length>1){n.unshift(l.all);$.each(n,j)}else{j(0,l.all)}if(r.length>1){$.each(r,j)}if(k.length){$.each(k,j)}else{$(".page-header").html("Oh no! Not enough checkins to make any meshus.");$("#finish-button").html("Make one manually")}};var p=0;var f=function(i){$.ajax({url:i,dataType:"jsonp",success:function(y){console.log("success");var w=y.response.checkins.items;if(!w||!w.length){g();return}p+=y.response.checkins.items.length;$.each(w,function(B,D){if(!D.venue||!D.venue.location||!D.venue.location.city){return}var F=D.venue.location.city;var E=D.venue.location.country;var z={latitude:D.venue.location.lat,longitude:D.venue.location.lng,name:D.venue.name,times:1};var A={name:F,latitude:z.latitude,longitude:z.longitude};if(!l[F]){l.all.locations.push(A)}e(k,F);e(n,E);b(k,F,z,z.name);b(n,E,A,F);var C=D.venue.location.state;if(C&&E=="United States"){if(o[C.toUpperCase()]){C=o[C.toUpperCase()]}e(r,C);b(r,C,A,A.name)}});var x=y.response.checkins.count;if(p<x){$(".page-header").html("Loaded "+p+" of "+x+" checkins...");f(s.replace("{offset}",p))}else{$(".page-header").html("Each meshu is a different set of places. Choose one to get started!");g()}}})};f(s.replace("{offset}",p))};

// app.js
$(function(){$("body").detect();var p={earrings:{acrylic:{price:75,colors:["Black","Grey","White"]},wood:{price:80,colors:["Amber","Blonde"]},nylon:{price:90,colors:["Black","Grey","White"]},silver:{price:150}},pendant:{acrylic:{price:75,colors:["Black","Grey","White"]},wood:{price:80,colors:["Amber","Blonde"]},nylon:{price:90,colors:["Black","Grey","White"]},silver:{price:130}},necklace:{acrylic:{price:80,colors:["Black","Grey","White"]},wood:{price:85,colors:["Amber","Blonde"]},nylon:{price:95,colors:["Black","Grey","White"]},silver:{price:150}},cufflinks:{stainless:{price:85},silver:{price:160}}};var d={earrings:"pair of earrings",pendant:"small pendant necklace",necklace:"large necklace",cufflinks:"pair of cufflinks"};var m={earrings:"earrings",pendant:"pendant necklace",necklace:"large necklace",cufflinks:"cufflinks"};var h=4;var l=["edit","product","make","account","checkout","review"];var g=$("#content");orderer.options(p);sb.materializer.initialize(p,d,m);var k=sb.meshu($("#meshu-container")[0]);k.isReadymade=loadedMeshu&&loadedMeshu.product!="";if(loadedMeshu){saver.initialize(k,loadedMeshu.view_url);if($("html").hasClass("svg")){k.locationData(loadedMeshu.location_data)}user.updateLogoutActions(pageType);sb.product.initialize(".delaunay");switch(pageType){case"edit":l=["edit","product","make","account","checkout","review"];break;case"view":l=["view"];break;case"product":var j=$("#product");j.find(".nav").remove();j.find(".make-wrapper").removeClass("make-wrapper");l=["product","make","account","checkout","review"];break;default:l=["readymade","account","checkout","review"];$("#materials").addClass("ready");var j=loadedMeshu.product.length?loadedMeshu.product:"necklace";sb.materializer.product(j);break}$("#finish-button").addClass("active");$("#meshu-container").removeClass("inactive");var o=loadedMeshu.location_data.split("|");$.each(o,function(r,t){var s=t.split("\t");if(s.length==3){var u=document.createElement("div");u.innerHTML=s[2];var q=u.firstChild.nodeValue;$("<li>").html(q).appendTo($("#display-places"))}});d3.select("#place-number").attr("class","").select(".title-text").html(function(q){q.title=loadedMeshu.title;k.updateTitle(q.title);return q.title})}else{saver.initializeNewMeshu(k)}if(user.loggedIn){n()}if(!user.loggedIn&&!(loadedMeshu&&pageType!="edit")&&window.location.hash!="#skipintro"){$("#edit-help").fadeIn();$("#modal-bg").fadeIn();$("#close-help").click(function(){$("#edit-help").fadeOut();$("#modal-bg").fadeOut()})}else{if(window.location.hash=="#skipintro"){window.location.hash=""}}$(".next").live("click",function(){if(!$(this).hasClass("active")){return}var t=$(this);var q=g.attr("class");var r=l.indexOf(q);var s=function(){g.attr("class",l[r+1])};if(q=="edit"&&user.loggedIn){saver.createOrUpdateMeshu()}if(q=="make"||q=="readymade"){n()}if(q=="account"&&!user.loggedIn){user.afterLogIn=function(){saver.createOrUpdateMeshu(function(){t.click()})};return}c(q);user.updateLogoutActions(q);s()});$(".back").click(function(){var q=g.attr("class");if(q=="checkout"){n()}var r=l.indexOf(q);var s=l[r-1];g.attr("class",s);a(s)});$("#save-and-view").click(function(){var q=function(){saver.createOrUpdateMeshu(function(r){window.location.href=r.meshu_url})};if(!user.loggedIn){e();user.afterLogIn=q}else{q()}});$("#product-preview svg").live("click",function(){var q=$(this).attr("id").split("-")[1];$(".make-option").hide();$("#make-"+q).show();sb.rotator.update(q);sb.materializer.product(q);sb.rotator.on("rotated",sb.product.rotation)});function c(q){switch(q){case"edit":k.updateBounds();k.mesh().updateCircleBehavior();sb.product.initialize(".delaunay");break;case"make":k.mesh().updateCircleBehavior(true);k.animateTransform(sb.rotator?sb.rotator.rotation():0);break;case"readymade":k.mesh().updateCircleBehavior(true);break;case"review":i();break}}function a(q){switch(q){case"edit":k.mesh().updateCircleBehavior();break;case"make":case"readymade":k.mesh().updateCircleBehavior();k.animateTransform(0);break}}function n(){var q=l.indexOf("account");if(user.loggedIn){if(q>=0){l.splice(q,1)}$("#account").css("visibility","hidden")}else{if(q==-1){l.splice(-2,0,"account")}$("#account").css("visibility","visible")}}$(".show-places").click(function(){$("#display-places").slideToggle();$(".show-places").toggle()});$("#payment-form").validate({rules:{shipping_zip:{digits:true,minlength:5},shipping_state:{minlength:2},card_number:{creditcard:true},card_cvc:{digits:true,minlength:3},card_month:{digits:true,minlength:2},card_year:{digits:true,minlength:4,}},messages:{shipping_state:"Please enter the two-letter state abbreviation.",card_cvc:"Sorry, that is not a valid CVC code",card_month:{minlength:"Please enter the month as a two-digit number."},card_year:{minlength:"Please enter the year as a four-digit number.",},},submitHandler:f});$("#coupon-code").submit(function(){var q=$("#coupon-code-value").val();orderer.applyCoupon(q,function(r){if(r.success){var s=r.amount;$("<h2>").attr("id","subtotal-coupon").addClass("review-header").html("Coupon:<span>-$"+s+".00</span>").insertAfter("#subtotal-price");$("#coupon-message").fadeIn("fast").html(q+" discount applied!");$(".coupon-form").hide()}else{$("#coupon-message").fadeIn("fast").html("Oops, invalid code.")}i()});return false});$("#review-button").click(function(){if(!user.loggedIn){e()}});$("#submit-button").click(function(q){if(!user.loggedIn){e();return false}orderer.submit()});function f(){if(!user.loggedIn){e(f);return}g.attr("class","review");c("review")}function e(q){user.showModal();user.afterLogIn=function(){if(q){saver.createOrUpdateMeshu(function(){setTimeout(q,200)})}}}function i(){orderer.updateProduct(sb.materializer.product(),sb.materializer.material(),h);$("#object-type").val(sb.materializer.productName());$("#object-material").val(sb.materializer.material());$("#object-color").val(sb.materializer.color().toLowerCase());$("#object-amount").val(orderer.getTotalCents());$("#svg-theta").val(sb.rotator?sb.rotator.rotation():0);$("#svg-file").val(k.outputSVG());$("#meshu-data").val(k.outputLocationData());$("#meshu-title").val(loadedMeshu?loadedMeshu.title:k.outputTitle());b();$("#review-shipping").empty();$(".ship-row input").each(function(){var s;var r=function(t){return t.replace(/\w\S*/g,function(u){return u.charAt(0).toUpperCase()+u.substr(1).toLowerCase()})};this.value=r(this.value);switch(this.id){case"ship-city":case"ship-zip":s=$("<span>");break;case"ship-state":this.value=this.value.toUpperCase();s=$("<span>");break;default:s=$("<p>");break}s.text($(this).val()).appendTo("#review-shipping")});var q=$("#card-number").val();$("#review-payment").text("XXXX-XXXX-XXXX-"+q.substring(12,16))}function b(){var q="One "+sb.materializer.displayName();var r=sb.materializer.color().toLowerCase()+" "+sb.materializer.material();$("#review-description").text(q+", made out of "+r);$("#subtotal-price span").text(orderer.getPriceString());$("#shipping-price span").text("$"+h+".00");$("#total-price span").text(orderer.getTotalString())}});$.fn.detect=function(){var e=navigator.userAgent,d={ie:e.match(/MSIE\s([^;]*)/)?true:false,ios:e.match(/like Mac OS X/i)?true:false,iphone:e.match(/iPhone/i)?true:false,ipad:e.match(/iPad/i)?true:false,android:e.match(/Android/i)?true:false,webos:e.match(/WebOS/i)?true:false,firefox:e.match(/Firefox/i)?true:false,webkit:e.match(/WebKit/i)?true:false,safari:e.match(/Safari/i)?true:false,chrome:e.match(/Chrome/i)?true:false,opera:e.match(/Opera/i)?true:false};if(/MSIE (\d+\.\d+);/.test(navigator.userAgent)){var b=Math.floor(new Number(RegExp.$1));var c="ie"+b}d.mobile=d.iphone||d.android;for(var a in d){if(a=="ie"){this.addClass(c)}this.toggleClass(a,d[a])}return this};
