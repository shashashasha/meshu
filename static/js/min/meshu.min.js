var sb=sb||{};var app_key="dj0yJmk9M1hsekZBSDY1ZjRxJmQ9WVdrOU5uUjZiRzE0TXpRbWNHbzlNVEV5TURZMU1qRTJNZy0tJnM9Y29uc3VtZXJzZWNyZXQmeD00OQ--";sb.meshu=function(d,e){var p={},c=$(d).width()+"px",m=$(d).height()+"px",a=e||sb.map(d,c,m),q=sb.mesh(d,a,c,m),o=$("#cases");$(d).append("<div class='mapui'><div id='zoomin'></div><div id='zoomout'></div></div>");$("#zoomin").mousedown(function(r){a.map.zoom(a.map.zoom()+1);q.refresh()});$("#zoomout").mousedown(function(r){a.map.zoom(a.map.zoom()-1);q.refresh()});var k=$("#searchbox");k.focus(function(){o.fadeOut()});k.keypress(function(r){if(r.which==13){f()}});$("#search-button").click(function(){f()});q.on("added",g);function g(){var r=q.points();if(r.length>3){$("#finish-button").addClass("active")}else{$("#finish-button").removeClass("active")}}function f(){var r=k.val();if(r=="add a city, place, or address"){return}var t=r.replace("&","and").replace(/[^\w ]/ig,"").replace(" ","+");var s=$("body").hasClass("ie")?"/proxy/geocoder/?location="+t:"http://where.yahooapis.com/geocode?location="+t+"&flags=J&appid="+app_key;k.val("");$.ajax({url:s,cache:false,dataType:"json",error:function(u,w,v){console.log(v)},success:function(x){var v=x.ResultSet.Results||[x.ResultSet.Result];var w=$("#content");o.empty().hide();if(typeof v=="undefined"){k.blur();o.append($("<p>").text("Hrm, we weren't able to find your search. Try again?")).fadeIn()}else{if(v.length==1){b(v[0],r);if(q.points().length==1){var u=v[0].radius;if(u>1000000){a.map.zoom(3)}else{if(u>100000){a.map.zoom(4)}else{if(u>10000){a.map.zoom(12)}else{if(u>400){a.map.zoom(14)}}}}}}else{o.append($("<p>").text("Oops, we're not sure which place you meant. Try a more specific search?")).fadeIn();k.blur()}}}})}function b(r,s){q.add(r.latitude,r.longitude,s);p.updateBounds();g()}p.locations=function(r,t){for(var s=0;s<r.length;s++){if(t){b(r[s],r[s].name)}else{setTimeout(function(u){return function(){b(u,u.name)}}(r[s]),s*400)}}};p.locationData=function(v){var r=v.split("|");var u=[];for(var t=0;t<r.length;t++){var s=r[t].split("\t");if(s.length!=3){continue}u.push({latitude:parseFloat(s[0]),longitude:parseFloat(s[1]),name:s[2]})}q.locations(u);p.updateBounds();return p};p.mesh=function(){return q};p.map=function(){return a};var i=0,h=1,n=0,l=0;var j;p.animateTransform=function(y,x,v,t){if(j){clearInterval(j)}var u=0;var w=d3.select(".delaunay");j=setInterval(function(){if(++u<30){i+=(y-i)*0.33;h+=(x-h)*0.5;n+=(v-n)*0.5;l+=(t-l)*0.5;var r="rotate("+i+", 300, 300)";var z="scale("+h+")";var s="translate("+n+","+l+")";w.attr("transform",z+s+r)}else{clearInterval(j)}},40)};p.refreshWithBounds=function(s,r){a.updateBounds(s,r);q.updatePixelBounds();q.refresh()};p.updateBounds=function(){a.updateBounds(q.lats(),q.lons());q.updatePixelBounds();q.refresh()};p.updateTitle=function(r){q.updateTitle(r)};p.outputTitle=function(){return q.outputTitle()};p.outputSVG=function(){return q.output()};p.hideMesh=function(){return p};p.showMesh=function(){return p};p.outputLocationData=function(){var r=[];var t=q.places(),u=q.lats(),s=q.lons();$.each(t,function(w){var v=u[w]+"\t"+s[w]+"\t"+t[w];r.push(v)});return r.join("|")};return p};