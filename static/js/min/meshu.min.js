var sb=sb||{};var app_key="dj0yJmk9M1hsekZBSDY1ZjRxJmQ9WVdrOU5uUjZiRzE0TXpRbWNHbzlNVEV5TURZMU1qRTJNZy0tJnM9Y29uc3VtZXJzZWNyZXQmeD00OQ--";sb.meshu=function(d,e){var o={},c=$(d).width()+"px",l=$(d).height()+"px",a=e||sb.map(d,c,l),p=sb.mesh(d,a,c,l),n=$("#cases");$(d).append("<div class='mapui'><div id='zoomin'></div><div id='zoomout'></div></div>");$("#zoomin").mousedown(function(q){a.map.zoom(a.map.zoom()+1);p.refresh()});$("#zoomout").mousedown(function(q){a.map.zoom(a.map.zoom()-1);p.refresh()});var j=$("#searchbox");j.focus(function(){n.fadeOut()});j.keypress(function(q){if(q.which==13){f()}});$("#search-button").click(function(){f()});o.checkAdded=function(){var q=p.points();if(q.length>3){$("#finish-button").addClass("active")}else{$("#finish-button").removeClass("active")}};function f(){var q=j.val();if(q=="add a city, place, or address"){return}var s=q.replace("&","and").replace(/[^\w ]/ig,"").replace(" ","+");var r=$("body").hasClass("ie")?"/proxy/geocoder/?location="+s:"http://where.yahooapis.com/geocode?location="+s+"&flags=J&appid="+app_key;j.val("");$.ajax({url:r,cache:false,dataType:"json",error:function(t,v,u){console.log(u)},success:function(w){var u=w.ResultSet.Results||[w.ResultSet.Result];var v=$("#content");n.empty().hide();if(typeof u=="undefined"){j.blur();n.append($("<p>").text("Hrm, we weren't able to find your search. Try again?")).fadeIn()}else{if(u.length==1){b(u[0],q);if(p.points().length==1){var t=u[0].radius;if(t>1000000){a.map.zoom(3)}else{if(t>100000){a.map.zoom(4)}else{if(t>10000){a.map.zoom(12)}else{if(t>400){a.map.zoom(14)}}}}}}else{n.append($("<p>").text("Oops, we're not sure which place you meant. Try a more specific search?")).fadeIn();j.blur()}}}})}function b(q,r){p.add(q.latitude,q.longitude,r);o.updateBounds()}o.locations=function(q,s){for(var r=0;r<q.length;r++){if(s){b(q[r],q[r].name)}else{setTimeout(function(t){return function(){b(t,t.name)}}(q[r]),r*400)}}};o.locationData=function(u){var q=u.split("|");var t=[];for(var s=0;s<q.length;s++){var r=q[s].split("\t");if(r.length!=3){continue}t.push({latitude:parseFloat(r[0]),longitude:parseFloat(r[1]),name:r[2]})}p.locations(t);return o};o.mesh=function(){return p};o.map=function(){return a};var h=0,g=1,m=0,k=0;var i;o.animateTransform=function(x,w,u,q){if(i){clearInterval(i)}var t=0;var v=d3.select(".delaunay");i=setInterval(function(){if(++t<30){h+=(x-h)*0.33;g+=(w-g)*0.5;m+=(u-m)*0.5;k+=(q-k)*0.5;var r="rotate("+h+", 300, 300)";var y="scale("+g+")";var s="translate("+m+","+k+")";v.attr("transform",y+s+r)}else{clearInterval(i)}},40)};o.refreshWithBounds=function(r,q){a.updateBounds(r,q)};o.updateBounds=function(){o.refreshWithBounds(p.lats(),p.lons())};p.on("added",o.checkAdded);a.on("boundsUpdated",function(){p.updatePixelBounds();p.refresh()});p.on("locationsSet",o.updateBounds);o.updateTitle=function(q){p.updateTitle(q)};o.outputTitle=function(){return p.outputTitle()};o.outputSVG=function(){return p.output()};o.hideMesh=function(){return o};o.showMesh=function(){return o};o.outputLocationData=function(){var q=[];var s=p.places(),t=p.lats(),r=p.lons();$.each(s,function(v){var u=t[v]+"\t"+r[v]+"\t"+s[v];q.push(u)});return q.join("|")};return o};