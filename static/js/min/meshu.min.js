var sb=sb||{};var app_key="dj0yJmk9M1hsekZBSDY1ZjRxJmQ9WVdrOU5uUjZiRzE0TXpRbWNHbzlNVEV5TURZMU1qRTJNZy0tJnM9Y29uc3VtZXJzZWNyZXQmeD00OQ--";sb.meshu=function(j,o,h){var k={},m=$(j).width()+"px",l=$(j).height()+"px",r=h||sb.map(j,m,l),o=o||"facet",b=sb.mesh[o](j,r,m,l),d=$("#cases");$(j).append("<div class='mapui'><div id='zoomin'></div><div id='zoomout'></div></div>");$("#zoomin").mousedown(function(t){r.map.zoom(r.map.zoom()+1);b.refresh("zoomed")});$("#zoomout").mousedown(function(t){r.map.zoom(r.map.zoom()-1);b.refresh("zoomed")});var a=$("#searchbox");a.focus(function(){d.fadeOut()}).keypress(function(u){if(u.which==13){var t=a.val();q(t)}});$("#search-button").click(function(){var u=a.val();if(u.split("|").length>2){var t=u.split("|");for(var v=0;v<t.length;v++){setTimeout(function(w){return function(){q(w)}}(t[v]),v*1000)}}else{q(u)}});k.checkAdded=function(){var u=b.points();var t=3;if($("body").hasClass("radial")){t=1}if(u.length>=t){$("#finish-button").addClass("active")}else{$("#finish-button").removeClass("active")}};function q(t){if(t=="add a city, place, or address"){return}var v=t.replace("&","and").replace(/[^\w ]/ig,"").replace(" ","+");var u="/proxy/geocoder/?location="+v;a.val("");$.ajax({url:u,cache:false,dataType:"json",error:function(w,y,x){console.log(x)},success:function(x){var w=x.results;d.empty().hide();if(typeof w=="undefined"||w[0].locations.length==0){var z="Hrm, we weren't able to find your search. Try again?";d.append($("<p>").text(z)).fadeIn();a.focus();return}var y=w[0].locations[0];if(b.name=="radial"){e(y.geocodeQuality,12);b.add(y.latLng.lat,y.latLng.lng,t)}else{b.add(y.latLng.lat,y.latLng.lng,t);k.updateBounds();if(b.points().length==1){e(y.geocodeQuality)}}}})}function i(t){switch(t){case"POINT":case"ADDRESS":case"INTERSECTION":case"STREET":return 14;case"ZIP":case"ZIP_EXTENDED":return 13;case"CITY":return 12;case"COUNTY":return 10;case"STATE":return 6;case"COUNTRY":return 4;default:return 12}}function e(v,t){var u=Math.max(t||4,i(v));if(u!=r.map.zoom()){r.map.zoom(u)}}k.locations=function(t,v){for(var u=0;u<t.length;u++){if(v){b.add(t[u].latitude,location[u].longitude,t[u].name)}else{setTimeout(function(w){return function(){b.add(w.latitude,w.longitude,w.name);k.updateBounds()}}(t[u]),u*400)}}if(v){k.updateBounds()}};function c(y){var t=y.split("|");var x=[],v={};for(var w=0;w<t.length;w++){var u=t[w].split("\t");if(u.length<3){continue}var z=u[0]+"-"+u[1];if(v[z]){continue}else{v[z]=true}x.push({latitude:parseFloat(u[0]),longitude:parseFloat(u[1]),name:u[2]})}return x}k.initializeFromData=function(w,v,u){b.prerender(u);var t=c(w);b.locations(t);if(v){b.applyStyle(v)}return k};k.mesh=function(){return b};k.map=function(){return r};var g=0,f=1,p=0,n=0;var s;k.animateTransform=function(y,x,v,t){if(s){clearInterval(s)}var u=0;var w=d3.select(".delaunay");s=setInterval(function(){if(++u<30){g+=(y-g)*0.33;f+=(x-f)*0.5;p+=(v-p)*0.5;n+=(t-n)*0.5;var z="rotate("+g+", 300, 300)";var B="scale("+f+")";var A="translate("+p+","+n+")";w.attr("transform",B+A+z)}else{clearInterval(s)}},40)};k.refreshWithBounds=function(u,t){r.updateBounds(u,t,k.zoomOffset)};k.updateBounds=function(){if(b.dirty){k.refreshWithBounds(b.lats(),b.lons());b.dirty=false}};b.on("added",k.checkAdded);r.on("boundsUpdated",function(){if(b.updatePixelBounds){b.updatePixelBounds()}b.refresh()});b.on("locationsSet",k.updateBounds);k.getFrame=function(){return j};k.updateTitle=function(u){b.updateTitle(u)};k.outputTitle=function(){return b.outputTitle()};k.outputSVG=function(){return b.output()};k.outputMapSVG=function(){return $(r.map.container()).html()};k.hideMesh=function(){return k};k.showMesh=function(){return k};k.outputLocationData=function(){var t=[];var v=b.places(),w=b.lats(),u=b.lons();$.each(v,function(y){var x=w[y]+"\t"+u[y]+"\t"+v[y];t.push(x)});return t.join("|")};k.xhr=function(){return{xhr:"true",title:k.outputTitle(),svg:k.outputSVG(),location_data:k.outputLocationData(),renderer:b.name,metadata:b.outputStyle(),promo:meshu.promo}};return k};