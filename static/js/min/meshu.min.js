var sb=sb||{};var app_key="dj0yJmk9M1hsekZBSDY1ZjRxJmQ9WVdrOU5uUjZiRzE0TXpRbWNHbzlNVEV5TURZMU1qRTJNZy0tJnM9Y29uc3VtZXJzZWNyZXQmeD00OQ--";sb.meshu=function(i,o,h){var k={},m=$(i).width()+"px",l=$(i).height()+"px",t=h||sb.map(i,m,l),o=o||"facet",b=sb.mesh[o](i,t,m,l),d=$("#cases"),s=200,q=0;$(i).append("<div class='mapui'><div id='zoomin'></div><div id='zoomout'></div></div>");$("#zoomin").mousedown(function(v){t.map.zoom(t.map.zoom()+1);b.refresh("zoomed")});$("#zoomout").mousedown(function(v){t.map.zoom(t.map.zoom()-1);b.refresh("zoomed")});var a=$("#searchbox");a.focus(function(){d.fadeOut()}).keypress(function(w){if(w.which==13){var v=a.val();r(v)}});$("#search-button").click(function(){var w=a.val();if(w.split("|").length>2){var v=w.split("|");for(var x=0;x<v.length;x++){setTimeout(function(y){return function(){r(y)}}(v[x]),x*1000)}}else{r(w)}});function r(v){if(v=="add a city, place, or address"){return}var x=v.replace("&","and").replace(/[^\w ]/ig,"").replace(" ","+");var w="/proxy/geocoder/?location="+x;a.val("");$.ajax({url:w,cache:false,dataType:"json",error:function(y,A,z){console.log(z)},success:function(z){var y=z.bossresponse.placefinder.results;d.empty().hide();if(typeof y=="undefined"){a.blur();var B="Hrm, we weren't able to find your search. Try again?";d.append($("<p>").text(B)).fadeIn()}else{if(y.length>0){var A=y[0];switch(b.name){case"facet":case"print":b.add(A.offsetlat,A.offsetlon,v);k.updateBounds();if(b.points().length==1){f(A.radius)}break;case"radial":f(A.radius/10);b.add(A.offsetlat,A.offsetlon,v);break}}}}})}function j(v){if(v>100000){return 4}else{if(v>10000){return 12}else{if(v>1000){return 13}else{if(v>400){return 14}}}}return 12}function f(v){var w=j(v);if(w!=t.map.zoom()){t.map.zoom(w)}}k.locations=function(v,x){for(var w=0;w<v.length;w++){if(x){b.add(v[w].latitude,location[w].longitude,v[w].name)}else{setTimeout(function(y){return function(){b.add(y.latitude,y.longitude,y.name);k.updateBounds()}}(v[w]),w*400)}}if(x){k.updateBounds()}};function c(A){var v=A.split("|");var z=[],x={};for(var y=0;y<v.length;y++){var w=v[y].split("\t");if(w.length<3){continue}var B=w[0]+"-"+w[1];if(x[B]){continue}else{x[B]=true}z.push({latitude:parseFloat(w[0]),longitude:parseFloat(w[1]),name:w[2]})}return z}k.initializeFromData=function(y,x,w){b.prerender(w);var v=c(y);b.locations(v);if(x){b.applyStyle(x)}return k};k.mesh=function(){return b};k.map=function(){return t};var g=0,e=1,p=0,n=0;var u;k.animateTransform=function(A,z,x,v){if(u){clearInterval(u)}var w=0;var y=d3.select(".delaunay");u=setInterval(function(){if(++w<30){g+=(A-g)*0.33;e+=(z-e)*0.5;p+=(x-p)*0.5;n+=(v-n)*0.5;var B="rotate("+g+", 300, 300)";var D="scale("+e+")";var C="translate("+p+","+n+")";y.attr("transform",D+C+B)}else{clearInterval(u)}},40)};k.refreshWithBounds=function(w,v){t.updateBounds(w,v,k.zoomOffset,s,q)};k.updateBounds=function(){if(b.dirty){k.refreshWithBounds(b.lats(),b.lons());b.dirty=false}};t.on("boundsUpdated",function(){if(b.updatePixelBounds){b.updatePixelBounds()}b.refresh()});b.on("locationsSet",k.updateBounds);k.getFrame=function(){return i};k.getRenderer=function(){return o};k.updateTitle=function(v){b.updateTitle(v)};k.outputTitle=function(){return b.outputTitle()};k.outputSVG=function(){return b.output()};k.outputMapSVG=function(){return $(t.map.container()).html()};k.hideMesh=function(){return k};k.showMesh=function(){return k};k.outputLocationData=function(){var v=[];var x=b.places(),y=b.lats(),w=b.lons();$.each(x,function(A){var z=y[A]+"\t"+w[A]+"\t"+x[A];v.push(z)});return v.join("|")};k.xhr=function(){return{xhr:"true",title:k.outputTitle(),svg:k.outputSVG(),location_data:k.outputLocationData(),renderer:b.name,metadata:b.outputStyle(),promo:meshu.promo}};return k};