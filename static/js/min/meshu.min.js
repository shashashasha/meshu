var sb=sb||{};var app_key="dj0yJmk9M1hsekZBSDY1ZjRxJmQ9WVdrOU5uUjZiRzE0TXpRbWNHbzlNVEV5TURZMU1qRTJNZy0tJnM9Y29uc3VtZXJzZWNyZXQmeD00OQ--";sb.meshu=function(j,p,h){var k={},n=$(j).width()+"px",l=$(j).height()+"px",s=h||sb.map(j,n,l),p=p||"facet",b=sb.mesh[p](j,s,n,l),f=$("#search-error"),u=$(".loading");k.offsetX=0;$(j).append("<div class='mapui'><div id='zoomin'></div><div id='zoomout'></div></div>");$("#zoomin").mousedown(function(v){s.map.zoom(s.map.zoom()+1);b.refresh("zoomed")});$("#zoomout").mousedown(function(v){s.map.zoom(s.map.zoom()-1);b.refresh("zoomed")});var a=$("#searchbox");a.keypress(function(w){f.fadeOut();if(w.which==13){var v=a.val();m(v)}});$("#search-button").click(function(){var v=a.val();m(v)});function m(w){if(w.split("|").length>2){var v=w.split("|");for(var x=0;x<v.length;x++){setTimeout(function(y){return function(){r(y)}}(v[x]),x*1000)}}else{r(w)}}function r(v){if(v=="add a city, place, or address"){return}var x=v.replace("&","and").replace(/[^\w ]/ig,"").replace(" ","+");var w="http://open.mapquestapi.com/geocoding/v1/address/?location="+x;a.val("");$.ajax({url:w,cache:false,crossDomain:false,dataType:"json",beforeSend:function(){u.show()},error:function(y,A,z){console.log(z)},success:function(z){var y=z.results;u.hide();if(typeof y=="undefined"||y[0].locations.length==0){f.fadeIn();a.focus();return}else{if(y.length){var A=y[0].locations[0];switch(b.name){case"facet":case"print":b.add(A.latLng.lat,A.latLng.lng,v);k.updateBounds();if(b.points().length==1){d(A.geocodeQuality)}break;case"radial":d(A.geocodeQuality,12);b.add(A.latLng.lat,A.latLng.lng,v);break}}}}})}function i(v){switch(v){case"POINT":case"ADDRESS":case"INTERSECTION":case"STREET":return 14;case"ZIP":case"ZIP_EXTENDED":return 13;case"CITY":return 12;case"COUNTY":return 10;case"STATE":return 6;case"COUNTRY":return 4;default:return 12}}function d(x,v){var w=Math.max(v||4,i(x));if(w!=s.map.zoom()){s.map.zoom(w)}}k.locations=function(v,x){for(var w=0;w<v.length;w++){if(x){b.add(v[w].latitude,location[w].longitude,v[w].name)}else{setTimeout(function(y){return function(){b.add(y.latitude,y.longitude,y.name);k.updateBounds()}}(v[w]),w*400)}}if(x){k.updateBounds()}};function c(A){var v=A.split("|");var z=[],x={};for(var y=0;y<v.length;y++){var w=v[y].split("\t");if(w.length<3){continue}var B=w[0]+"-"+w[1];if(x[B]){continue}else{x[B]=true}z.push({latitude:parseFloat(w[0]),longitude:parseFloat(w[1]),name:w[2]})}return z}k.initializeFromData=function(y,x,w){b.prerender(w);var v=c(y);b.locations(v);if(x){b.applyStyle(x)}return k};k.mesh=function(){return b};k.map=function(){return s};var g=0,e=1,q=0,o=0;var t;k.animateTransform=function(A,z,x,v){if(t){clearInterval(t)}var w=0;var y=d3.select(".delaunay");t=setInterval(function(){if(++w<30){g+=(A-g)*0.33;e+=(z-e)*0.5;q+=(x-q)*0.5;o+=(v-o)*0.5;var B="rotate("+g+", 300, 300)";var D="scale("+e+")";var C="translate("+q+","+o+")";y.attr("transform",D+C+B)}else{clearInterval(t)}},40)};k.refreshWithBounds=function(w,v){s.updateBounds(w,v,k.zoomOffset,k.offsetX)};k.updateBounds=function(){if(b.dirty){k.refreshWithBounds(b.lats(),b.lons());b.dirty=false}};s.on("boundsUpdated",function(){if(b.updatePixelBounds){b.updatePixelBounds()}b.refresh()});b.on("locationsSet",k.updateBounds);k.getFrame=function(){return j};k.getRenderer=function(){return p};k.updateTitle=function(v){b.updateTitle(v)};k.outputTitle=function(){return b.outputTitle()};k.outputSVG=function(){return b.output()};k.outputMapSVG=function(){return $(s.map.container()).html()};k.hideMesh=function(){return k};k.showMesh=function(){return k};k.outputLocationData=function(){var v=[];var x=b.places(),y=b.lats(),w=b.lons();$.each(x,function(A){var z=y[A]+"\t"+w[A]+"\t"+x[A];v.push(z)});return v.join("|")};k.xhr=function(){return{xhr:"true",title:k.outputTitle(),svg:k.outputSVG(),location_data:k.outputLocationData(),renderer:b.name,metadata:b.outputStyle(),promo:meshu.promo}};return k};