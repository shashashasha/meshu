var sb=sb||{};var app_key="dj0yJmk9M1hsekZBSDY1ZjRxJmQ9WVdrOU5uUjZiRzE0TXpRbWNHbzlNVEV5TURZMU1qRTJNZy0tJnM9Y29uc3VtZXJzZWNyZXQmeD00OQ--";sb.meshu=function(j,o,h){var k={},m=$(j).width()+"px",l=$(j).height()+"px",r=h||sb.map(j,m,l),o=o||"facet",b=sb.mesh[o](j,r,m,l),e=$("#search-error"),t=$("#loading");k.offsetX=0;$(j).append("<div class='mapui'><div id='zoomin'></div><div id='zoomout'></div></div>");$("#zoomin").mousedown(function(u){r.map.zoom(r.map.zoom()+1);b.refresh("zoomed")});$("#zoomout").mousedown(function(u){r.map.zoom(r.map.zoom()-1);b.refresh("zoomed")});var a=$("#searchbox");a.keypress(function(v){e.fadeOut();if(v.which==13){var u=a.val();q(u)}});$("#search-button").click(function(){var v=a.val();if(v.split("|").length>2){var u=v.split("|");for(var w=0;w<u.length;w++){setTimeout(function(x){return function(){q(x)}}(u[w]),w*1000)}}else{q(v)}});function q(u){if(u=="add a city, place, or address"){return}var w=u.replace("&","and").replace(/[^\w ]/ig,"").replace(" ","+");var v="/proxy/geocoder/?location="+w;a.val("");$.ajax({url:v,cache:false,dataType:"json",beforeSend:function(){t.show()},error:function(x,z,y){console.log(y)},success:function(y){var x=y.results;t.hide();if(typeof x=="undefined"||x[0].locations.length==0){e.fadeIn();a.focus();return}else{if(x.length){var z=x[0].locations[0];switch(b.name){case"facet":case"print":b.add(z.latLng.lat,z.latLng.lng,u);k.updateBounds();if(b.points().length==1){d(z.geocodeQuality)}break;case"radial":d(z.geocodeQuality,12);b.add(z.latLng.lat,z.latLng.lng,u);break}}}}})}function i(u){switch(u){case"POINT":case"ADDRESS":case"INTERSECTION":case"STREET":return 14;case"ZIP":case"ZIP_EXTENDED":return 13;case"CITY":return 12;case"COUNTY":return 10;case"STATE":return 6;case"COUNTRY":return 4;default:return 12}}function d(w,u){var v=Math.max(u||4,i(w));if(v!=r.map.zoom()){r.map.zoom(v)}}k.locations=function(u,w){for(var v=0;v<u.length;v++){if(w){b.add(u[v].latitude,location[v].longitude,u[v].name)}else{setTimeout(function(x){return function(){b.add(x.latitude,x.longitude,x.name);k.updateBounds()}}(u[v]),v*400)}}if(w){k.updateBounds()}};function c(z){var u=z.split("|");var y=[],w={};for(var x=0;x<u.length;x++){var v=u[x].split("\t");if(v.length<3){continue}var A=v[0]+"-"+v[1];if(w[A]){continue}else{w[A]=true}y.push({latitude:parseFloat(v[0]),longitude:parseFloat(v[1]),name:v[2]})}return y}k.initializeFromData=function(x,w,v){b.prerender(v);var u=c(x);b.locations(u);if(w){b.applyStyle(w)}return k};k.mesh=function(){return b};k.map=function(){return r};var g=0,f=1,p=0,n=0;var s;k.animateTransform=function(z,y,w,u){if(s){clearInterval(s)}var v=0;var x=d3.select(".delaunay");s=setInterval(function(){if(++v<30){g+=(z-g)*0.33;f+=(y-f)*0.5;p+=(w-p)*0.5;n+=(u-n)*0.5;var A="rotate("+g+", 300, 300)";var C="scale("+f+")";var B="translate("+p+","+n+")";x.attr("transform",C+B+A)}else{clearInterval(s)}},40)};k.refreshWithBounds=function(v,u){console.log("refresh with bounds");r.updateBounds(v,u,k.zoomOffset,k.offsetX)};k.updateBounds=function(){if(b.dirty){k.refreshWithBounds(b.lats(),b.lons());b.dirty=false}};r.on("boundsUpdated",function(){if(b.updatePixelBounds){b.updatePixelBounds()}b.refresh()});b.on("locationsSet",k.updateBounds);k.getFrame=function(){return j};k.getRenderer=function(){return o};k.updateTitle=function(u){b.updateTitle(u)};k.outputTitle=function(){return b.outputTitle()};k.outputSVG=function(){return b.output()};k.outputMapSVG=function(){return $(r.map.container()).html()};k.hideMesh=function(){return k};k.showMesh=function(){return k};k.outputLocationData=function(){var u=[];var w=b.places(),x=b.lats(),v=b.lons();$.each(w,function(z){var y=x[z]+"\t"+v[z]+"\t"+w[z];u.push(y)});return u.join("|")};k.xhr=function(){return{xhr:"true",title:k.outputTitle(),svg:k.outputSVG(),location_data:k.outputLocationData(),renderer:b.name,metadata:b.outputStyle(),promo:meshu.promo}};return k};