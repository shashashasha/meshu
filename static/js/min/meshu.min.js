var sb=sb||{};var app_key="dj0yJmk9M1hsekZBSDY1ZjRxJmQ9WVdrOU5uUjZiRzE0TXpRbWNHbzlNVEV5TURZMU1qRTJNZy0tJnM9Y29uc3VtZXJzZWNyZXQmeD00OQ--",mapquestapi="Fmjtd%7Cluub2002n0%2Cbx%3Do5-9urx5r";sb.meshu=function(j,q,h){var k={},o=$(j).width()+"px",l=$(j).height()+"px",t=h||sb.map(j,o,l),q=q||"facet",b=sb.mesh[q](j,t,o,l),f=$("#search-error"),v=$(".loading");k.offsetX=0;$(j).append("<div class='mapui'><div id='zoomin'></div><div id='zoomout'></div></div>");var n=(q=="print")?0.5:1;$("#zoomin").mousedown(function(w){t.map.zoom(t.map.zoom()+n);b.refresh("zoomed")});$("#zoomout").mousedown(function(w){t.map.zoom(t.map.zoom()-n);b.refresh("zoomed")});var a=$("#searchbox");a.keypress(function(x){f.fadeOut();if(x.which==13){var w=a.val();m(w)}});$("#search-button").click(function(){var w=a.val();m(w)});function m(x){if(x.split("|").length>2){var w=x.split("|");for(var y=0;y<w.length;y++){setTimeout(function(z){return function(){s(z)}}(w[y]),y*1000)}}else{s(x)}}k.findCountry=function(x){var w="http://open.mapquestapi.com/geocoding/v1/reverse?key="+mapquestapi+"&location="+x[1]+","+x[0];$.ajax({url:w,cache:false,crossDomain:false,dataType:"json",error:function(y,A,z){console.log(z)},success:function(z){var y=z.results;if(typeof y=="undefined"||y[0].locations.length==0){return}else{if(y.length){var A=y[0].locations[0];b.addCountry(A.adminArea1)}}}})};function s(w){if(w=="add a city, place, or address"){return}var y=w.replace("&","and").replace(/[^\w ]/ig,"").replace(" ","+");var x="http://open.mapquestapi.com/geocoding/v1/address/?location="+y+"&key="+mapquestapi;a.val("");$.ajax({url:x,cache:false,crossDomain:false,dataType:"json",beforeSend:function(){v.show()},error:function(z,B,A){console.log(A)},success:function(A){var z=A.results;v.hide();if(typeof z=="undefined"||z[0].locations.length==0){f.fadeIn();a.focus();return}else{if(z.length){var B=z[0].locations[0];switch(b.name){case"facet":b.add(B.latLng.lat,B.latLng.lng,w);k.updateBounds();if(b.points().length==1){d(B.geocodeQuality)}break;case"print":b.add(B.latLng.lat,B.latLng.lng,w);k.updateBounds();b.addCountry(B.adminArea1);if(b.points().length==1){d(B.geocodeQuality)}break;case"radial":d(B.geocodeQuality,12);b.add(B.latLng.lat,B.latLng.lng,w);break}}}}})}function i(w){switch(w){case"POINT":case"ADDRESS":case"INTERSECTION":case"STREET":return 14;case"ZIP":case"ZIP_EXTENDED":return 13;case"CITY":return 12;case"COUNTY":return 10;case"STATE":return 6;case"COUNTRY":return 4;default:return 12}}function d(y,w){var x=Math.max(w||4,i(y));if(x!=t.map.zoom()){t.map.zoom(x)}}k.locations=function(w,y){for(var x=0;x<w.length;x++){if(y){b.add(w[x].latitude,location[x].longitude,w[x].name)}else{setTimeout(function(z){return function(){b.add(z.latitude,z.longitude,z.name);k.updateBounds()}}(w[x]),x*400)}}if(y){k.updateBounds()}};function c(B){var w=B.split("|");var A=[],y={};for(var z=0;z<w.length;z++){var x=w[z].split("\t");if(x.length<3){continue}var C=x[0]+"-"+x[1];if(y[C]){continue}else{y[C]=true}A.push({latitude:parseFloat(x[0]),longitude:parseFloat(x[1]),name:x[2]})}return A}k.initializeFromData=function(z,y,x){b.prerender(x);var w=c(z);b.locations(w);if(y){b.applyStyle(y)}return k};k.mesh=function(){return b};k.map=function(){return t};var g=0,e=1,r=0,p=0;var u;k.animateTransform=function(B,A,y,w){if(u){clearInterval(u)}var x=0;var z=d3.select(".delaunay");u=setInterval(function(){if(++x<30){g+=(B-g)*0.33;e+=(A-e)*0.5;r+=(y-r)*0.5;p+=(w-p)*0.5;var C="rotate("+g+", 300, 300)";var E="scale("+e+")";var D="translate("+r+","+p+")";z.attr("transform",E+D+C)}else{clearInterval(u)}},40)};k.refreshWithBounds=function(x,w){t.updateBounds(x,w,k.zoomOffset,k.offsetX)};k.updateBounds=function(){if(b.dirty){k.refreshWithBounds(b.lats(),b.lons());b.dirty=false}};t.on("boundsUpdated",function(){if(b.updatePixelBounds){b.updatePixelBounds()}b.refresh()});b.on("locationsSet",k.updateBounds);k.getFrame=function(){return j};k.getRenderer=function(){return q};k.updateTitle=function(w){b.updateTitle(w)};k.outputTitle=function(){return b.outputTitle()};k.outputSVG=function(){return b.output()};k.outputMapSVG=function(){return $(t.map.container()).html()};k.hideMesh=function(){return k};k.showMesh=function(){return k};k.outputLocationData=function(){var w=[];var y=b.places(),z=b.lats(),x=b.lons();$.each(y,function(B){var A=z[B]+"\t"+x[B]+"\t"+y[B];w.push(A)});return w.join("|")};k.xhr=function(){return{xhr:"true",title:k.outputTitle(),svg:k.outputSVG(),location_data:k.outputLocationData(),renderer:b.name,metadata:b.outputStyle(),promo:meshu.promo}};return k};