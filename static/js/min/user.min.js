var user=function(){var b={},c="Don't worry, we'll never give your email address to anyone else. We hate spam as much as you do!";b.loggedIn=false;b.fbID=0;b.mode="account";b.showModal=function(f){f=f||"account";var e=$(window).width();$("#modal-bg").fadeIn();$("#login-form").css("left",(e-380)/2+"px").fadeIn();$("#tab-"+f).click();$(".account-message").html(c);$(".login-row").find("input").val("")};b.hideModal=function(){$("#modal-bg").fadeOut();$("#login-form").fadeOut();$(".login-row").find("input").val("");$(".login-row").find(".error").remove();$(".account-message").html(c);$(".login-error").hide()};b.initialize=function(){$("#login").click(function(){b.showModal("signin")});$(".login-cancel").click(b.hideModal);$("#modal-bg").click(b.hideModal);$("#login-form li").click(function(){var f=$(this).attr("id").split("-")[1];var e=$("#login-form");e.attr("class",f);e.find("li").removeClass("active");$(this).addClass("active");b.mode=f});$(".login-row input").keypress(function(e){if(e.which==13){if(b.mode=="signin"){$("#login-signin").click()}else{if(b.mode=="account"){$("#login-account").click()}}}});$(".facebook-signin").click(function(){window.location="/facebook/login"});$("#form-signin").validate({rules:{signin_name:{email:true}},messages:{signin_name:"Sorry, that's not a valid email format."},submitHandler:function(){$.post("/user/login/",{xhr:"true",csrfmiddlewaretoken:$("#csrf input").val(),email:$("#signin_name").val(),password:$("#signin_password").val()},d,"json")}});$("#inline-signin").validate({rules:{inline_signin_name:{email:true}},messages:{inline_signin_name:"Sorry, that's not a valid email format."},submitHandler:function(){var e={xhr:"true",csrfmiddlewaretoken:$("#csrf input").val(),email:$("#inline_signin_name").val(),password:$("#inline_signin_password").val()};$.post("/user/login/",e,d,"json")}});$("#form-account").validate({rules:{account_name:{email:true},repeat_password:{equalTo:"#account_password"}},messages:{account_name:"Sorry, that's not a valid email format.",repeat_password:"Oops, those passwords didn't match. Try again?"},submitHandler:function(){$.post("/user/create/",{xhr:"true",csrfmiddlewaretoken:$("#csrf input").val(),email:$("#account_name").val(),password:$("#account_password").val()},d,"json")}});$("#inline-account").validate({rules:{inline_account_name:{email:true},inline_repeat_password:{equalTo:"#inline_account_password"}},messages:{inline_account_name:"Sorry, that's not a valid email format.",inline_repeat_password:"Oops, those passwords didn't match. Try again?"},submitHandler:function(){$.post("/user/create/",{xhr:"true",csrfmiddlewaretoken:$("#csrf input").val(),email:$("#inline_account_name").val(),password:$("#inline_account_password").val()},d,"json")}});$("#logout").click(function(f){if(FB&&b.fbID){FB.logout()}$.get("/user/logout/",{xhr:"true"},a,"json")})};b.updateLogoutActions=function(e){switch(e){case"user":b.logoutRedirect="/shop/";break;case"view":b.logoutRedirect=window.location.href;break;default:b.logoutRedirect=null;break}};b.facebookLogin=function(e,f){if(!e.authResponse||b.loggedIn){return}FB.api("/me",function(g){if(f){b.afterLogIn=f}$.post("/user/facebook/inline_login/",{xhr:"true",csrfmiddlewaretoken:$("#csrf input").val(),email:g.email,id:g.id,first_name:g.first_name,last_name:g.last_name,access_token:e.authResponse.accessToken},d,"json")})};function a(e){$("#login").show();$("#nav-cart").hide();$("#profile").hide();$("#logout").hide().html("");b.loggedIn=false;b.fbID=0;if(b.logoutRedirect){window.location.href=b.logoutRedirect}}function d(e){if(!e.success){$(".login-error").fadeIn();$("#login-form").click(function(){$(".login-error").hide()});if(e.duplicate){var f="Oops, looks like you already registered with that email.<br />Try logging in?";$(".account-message").html(f)}return}$(".account-message").html(c);$("#logout").show().html("logout");$("#profile").fadeIn();$("#login").hide();$("#modal-bg").fadeOut();$("#login-form").hide();b.loggedIn=true;if(e.facebook_id){b.fbID=e.facebook_id}if(b.afterLogIn){b.afterLogIn();b.afterLogIn=null}if(b.loginRedirect){window.location.href=b.loginRedirect}}return b}();$(function(){user.initialize()});