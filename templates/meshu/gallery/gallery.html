{% extends "meshu/base.html" %}

{% block title %}
    {% if view == 'user' %}Meshu - My Meshus{% endif %}
    {% if view == 'shop' %}Meshu - Shop Our Collection{% endif %}
{% endblock %}

{% block page_type %}{{ view }}{% endblock page_type %}

{% block content %}
    <h2 class="page-header">
    {% if view == 'user' %}
        {% if meshus|length == 0 %}
            You must be new! Let's get started.
        {% endif %}
        {% if meshus|length == 1 %}
            Welcome back. You've made one meshu.
        {% endif %}
        {% if meshus|length > 1 %}
            Welcome back. You've made {{ meshus|length }} meshus.
        {% endif %}
    {% endif %}
    {% if view == 'shop' %}
        A collection of our favorite meshus.
    {% endif %}
    </h2>
    <ul class="gallery" id="{% if view == 'user' %}usermade{% else %}gallery{% endif %}">
        {% if view == 'user' %}
            <li class="object">
                <a class="image blank" href="/make/"></a>
                <a class="clicknew" href="/make/">click to make a new meshu!</a>
            </li>
        {% endif %}
        {% for object in meshus reversed %}
            <li class="object">
                <div class="image"></div>
                <a href="
                    {% if view == 'shop' %}/shop/{{ object.id }}{% endif %}
                    {% if view == 'user' %}{{ object.get_absolute_url }}{% endif %}">
                {% if object.thumbnail != 'images/default_thumbnail.png' %}
                    <img src="{{ object.thumbnail.url }}" />
                {% else %}
                    {% autoescape off %}
                        {{ object.svg }}
                    {% endautoescape %}
                {% endif %}
                {% if view == 'shop' %}
                    <div class="text-block">
                        <span class="title">{{ object.title|safe }}</span><br>
                        <span class="description">{{ object.product }}</span>
                    </div>
                {% else %}
                    <p class="title">{{ object.title|safe }}</p>
                    <!-- <a class="clickthrough" href="{{ object.get_absolute_url }}">click to view</a> -->
                {% endif %}
                </a>
            </li>
        {% endfor %}
    </ul>
{% endblock %}

{% block script %}
    <script type="text/javascript" src="{{ STATIC_URL }}lib/d3.v2.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/min/gallery.min.js"></script>
    <script type="text/javascript">
        /*
            Fixing last row of objects bottom border.

            maybe this can actually be done in CSS, 
            but I'm not quite sure how....
        */
        var galleryObjects = $(".object");
        galleryObjects.each(function(i, e) {
            var max = galleryObjects.length;
            if (Math.floor(i / 4) >= (max-1) / 4) {
                $(e).addClass("last-object");
            }
        });
    </script>
{% endblock %}