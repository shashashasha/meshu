{% extends "meshu/base.html" %}

{% block title %}Meshu - {{ meshu.title }}{% endblock %}

{% block page_type %}{{ view }}{% endblock page_type %}

{% block content %}
    <div id="meshu-container" class="frame">
        <div id="place-hover">
            <span></span>
            <b class="notch"></b>
        </div>
    </div>

    {% block edit %}
        <div id="edit">
            <div id="search">
                <h2>Search</h2>
                <input type="text" id="searchbox" size="35" value="add a city, place, or address" 
                    onfocus="value=''"/>
                <div id="submit" class="button">search</div>
            </div>
            <div id="cases"></div>
            <div id="places">
            <h2 id="place-number"></h2>
            </div>

            {% block finish %}
            {% endblock %}
        </div>
    {% endblock %}

    {% block view %}
    {% endblock %}

    {% block make %}
    <div id="materials">
        {% block goback %}
        {% endblock %}

        <div class="make-wrapper">

            {% block options %}
            {% endblock %}

            <div class="left-div">
                <h2>Material</h2>
                <ul id="material-list" class="option-list">
                    <li id="nylon">Nylon</li>
                    <li id="silver">Silver</li>
                    <li id="wood">Wood</li>
                    <li id="acrylic">Acrylic</li>
                </ul>
            </div>
            <div class="right-div">
                <h2>Color</h2>
                <ul id="color-list" class="option-list">
                    <li></li>
                    <li></li>
                    <li></li>
                </ul>
            </div>
            <div id="total">
                <span id="total-cost">$50.00</span>
                <h2>Total</h2>
                <div id="checkout-button" class="nav next active">Checkout</div>
            </div>
        </div>
    </div>
    {% endblock %}

    {% block checkout %}
        <div id="checkout">
            <div class="nav back">back to materials</div>
            <div class="make-wrapper">
                <h2>Shipping</h2>
                <form action="/order/{{ meshu.id }}" method="POST" id="payment-form">
                    {# put a csrf token in every form in django, for security #}
                    {% csrf_token %}
                    <div id="hidden-form-values" style="display:none;">
                        <input type="hidden" id="object-material" name="material"/>
                        <input type="hidden" id="object-type" name="product"/>
                        <input type="hidden" id="object-color" name="color"/>
                        <input type="hidden" id="object-amount" name="amount"/>
                        <input type="hidden" id="svg-file" name="svg"/>
                        <input type="hidden" id="svg-theta" name="theta"/>
                        <input type="hidden" id="meshu-title" name="title"/>
                        <input type="hidden" id="meshu-data" name="location_data"/>
                    </div>
                    <div class="form-row ship-row">
                        <label>Name</label>
                        <input type="text" style="width:278px;" id="ship-name" class="required" name="shipping_name" value="{{ user.username }}" />
                    </div>
                    <div class="form-row ship-row">
                        <label>Address Row 1</label>
                        <input type="text" style="width:220px;" id="ship-add1" class="required" name="shipping_address"/>
                    </div>
                    <div class="form-row ship-row">
                        <label>Address Row 2</label>
                        <input type="text" style="width:220px;" id="ship-add2" name="shipping_address_2"/>
                    </div>
                    <div class="form-row ship-row">
                        <label>City</label>
                        <input type="text" style="width:170px;" id="ship-city" class="required" name="shipping_city"/>
                        <label>State</label>
                        <input type="text" size="2" style="margin-right:30px;" maxlength="2" id="ship-state" class="required" name="shipping_state"/>
                    </div>
                    <div class="form-row ship-row">
                        <label>Zip Code</label>
                        <input type="text" size="4" maxlength="5" id="ship-zip" class="required" name="shipping_zip"/>
                    </div>
                    <p class="note">Please allow 3-4 weeks for the shipping of acrylic and wood orders, and 5-6 weeks for nylon or silver</p>
                    <p class="note">At this time, we only ship to the US</p>
                    <h2>Payment</h2>
                        <div class="form-row">
                            <label>Card Number</label>
                            <input type="text" size="20" maxlength="16" autocomplete="off" class="card-number required" value="4242424242424242"/>
                        </div>
                        <div class="form-row">
                            <label>CVC</label>
                            <input type="text" size="3" maxlength="4" autocomplete="off" class="card-cvc required" value="424"/>
                        </div>
                        <div class="form-row">
                            <label>Expiration (MM/YYYY)</label>
                            <input type="text" size="1" maxlength="2" class="card-expiry-month required" value="12"/>
                            <span> / </span>
                            <input type="text" size="3" maxlength="4" class="card-expiry-year required"  value="2014"/>
                        </div>
                    <p class="note">All of our payments are securely handled through <a href="https://stripe.com/help/security" target="_blank">Stripe</a></p>
                </form>
            </div>
            <div class="nav next active" id="review-button">Review Your Order</div>
        </div>
        <div id="review">
            <div class="nav back">edit information</div>
            <div class="make-wrapper">
                <h2>Your Order</h2>
                <h2 class="review-header" id="review-title"></h2>
                <h2 class="review-header">Object:</h2>
                <p id="review-description"></p>
                <p id="review-price"></p>
                <h2 class="review-header">Shipping:</h2>
                <div id="review-shipping"></div>
                <h2 class="review-header">Payment:</h2>
                <p id="review-payment"></p>
                <input type="submit" id="submit-button" class="button" value="Submit Payment">
            </div>
        </div>
    {% endblock %}

{% endblock %}

{% block script %}
    <script type="text/javascript" src="https://js.stripe.com/v1/"></script>

    <script type="text/javascript" src="{{ STATIC_URL }}lib/polymaps.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}lib/d3.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}lib/d3.geom.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/stripe.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/map.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/mesh.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/meshu.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/preview.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/saver.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/app.js"></script>
{% endblock %}

{% block resources %}
    <script type="text/javascript">
    {% if meshu %}
        var loadedMeshu = {
            user: '{{ meshu.user_profile.user.username }}',
            edit_url: '{{ meshu.get_edit_url }}',
            view_url: '{{ meshu.get_absolute_url }}',
            title: '{{ meshu.title }}',
            location_data: '{{ meshu.location_data }}',
            svg: '{% autoescape off %}{{ meshu.svg }}{% endautoescape %}'
        };
        var pageType = "{{ view }}";
    {% else %} 
        var loadedMeshu = null;
    {% endif %}
    </script>  
{% endblock %}